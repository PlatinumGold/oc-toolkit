<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crime Sentence & Fine Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: Arial, sans-serif; margin:0; }
    header { background:#c0392b; color:#fff; padding:16px; text-align:center; font-size:1.5em; }
    main { max-width:800px; margin:20px auto; padding:0 16px; }
    h2 { margin-top:24px; }
    label { display:block; margin-top:12px; }
    select, input[type="number"], input[type="text"], input[type="color"] {
      width:100%; padding:8px; box-sizing:border-box; margin-top:4px;
    }
    .inline { display:inline-block; width:48%; vertical-align:top; }
    .inline + .inline { margin-left:4%; }
    button, input[type="button"] {
      margin-top:16px; padding:10px 20px;
      background:#c0392b; color:#fff; border:none; cursor:pointer; font-size:1em;
    }
    /* Global Trigger Warning Modal */
    #globalModal {
      display:none; position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.6); align-items:center; justify-content:center;
      z-index:1000;
    }
    #globalModal .modal {
      background:#fff; padding:20px; border-radius:6px;
      max-width:400px; text-align:center;
    }
    /* Stack & OC Cards */
    #stack, #ocs { margin-top:20px; }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { border:1px solid #ccc; padding:6px; text-align:left; }
    td small { display:block; color:#666; margin-top:4px; }
    #results, .oc-summary { margin-top:20px; padding:12px; background:#eef; border-radius:4px; }
    .oc-card {
      border:2px solid #c0392b; border-radius:6px; padding:10px;
      display:inline-block; width:240px; margin:8px; vertical-align:top;
      position: relative;
    }
    .oc-card img, .oc-card .placeholder {
      width:100%; height:120px; object-fit:cover; background:#ddd;
      display:flex; align-items:center; justify-content:center; color:#666;
    }
    .oc-card button.deleteOC {
      position: absolute; top:8px; right:8px; background:#c0392b; color:#fff;
      border:none; padding:4px 8px; cursor:pointer;
    }
    #persistMsg { font-size:.9em; color:#666; margin-top:8px; }
  </style>
</head>
<body>

<header>‚öñÔ∏è Crime Sentence & Fine Calculator</header>

<!-- Global Trigger Warning -->
<div id="globalModal">
  <div class="modal">
    <p><strong>Trigger Warning:</strong><br>
       This tool covers sensitive criminal content.<br>
       Click ‚ÄúI Understand‚Äù to proceed.</p>
    <button id="globalOk">I Understand</button>
  </div>
</div>

<main>

  <!-- OC Builder -->
  <h2>‚ñ∂Ô∏è Current OC</h2>
  <label>OC Name
    <input id="ocName" type="text" placeholder="Character Name‚Ä¶"/>
  </label>
  <label>Placeholder Color
    <input id="ocColor" type="color" value="#dddddd"/>
  </label>
  <label>OC Image
    <input id="ocImg" type="file" accept="image/*"/>
  </label>
  <button id="resetStack">üîÑ Reset Current Stack</button>

  <!-- Crime Input -->
  <h2>‚ûï Add Crime</h2>
  <label>Crime Category
    <select id="category">
      <option value="">‚Äî Select ‚Äî</option>
      <optgroup label="Violent Crimes">
        <option value="murder">Murder</option>
        <option value="assault">Assault</option>
        <option value="kidnapping">Kidnapping</option>
        <option value="sa">Sexual Violence</option>
        <option value="robbery">Robbery</option>
      </optgroup>
      <optgroup label="Property Crimes">
        <option value="theft">Theft</option>
        <option value="burglary">Burglary</option>
        <option value="arson">Arson</option>
        <option value="vandalism">Vandalism</option>
        <option value="embezzlement">Embezzlement</option>
      </optgroup>
      <optgroup label="White-Collar Crimes">
        <option value="fraud">Fraud</option>
        <option value="moneyLaundering">Money Laundering</option>
        <option value="taxEvasion">Tax Evasion</option>
        <option value="bribery">Bribery</option>
        <option value="blackmail">Blackmail</option>
        <option value="extortion">Extortion</option>
      </optgroup>
      <optgroup label="Political Crimes">
        <option value="espionage">Espionage</option>
        <option value="treason">Treason</option>
        <option value="terrorism">Terrorism</option>
        <option value="sedition">Sedition</option>
      </optgroup>
      <optgroup label="Drug-Related Crimes">
        <option value="possession">Possession (Class A/B/C)</option>
        <option value="trafficking">Trafficking</option>
        <option value="manufacturing">Manufacturing</option>
      </optgroup>
      <optgroup label="Public Order">
        <option value="publicIntox">Public Intoxication</option>
        <option value="prostitution">Prostitution</option>
        <option value="illegalGambling">Illegal Gambling</option>
      </optgroup>
      <optgroup label="Petty Crimes">
        <option value="trespassCivil">Trespass</option>
        <option value="trespassCriminal">Criminal Trespass</option>
        <option value="speeding">Speeding</option>
        <option value="redLight">Running a Red Light</option>
        <option value="noise">Noise Violations</option>
      </optgroup>
      <option value="other">Other‚Ä¶</option>
    </select>
  </label>

  <label>Subtype
    <select id="subtype" disabled></select>
  </label>
  <input id="otherText" type="text" placeholder="Enter custom crime" style="display:none;"/>

  <label>Country
    <select id="country">
      <option value="">Default (World Avg)</option>
      <option value="usa">USA</option>
      <option value="uk">UK</option>
      <option value="canada">Canada</option>
      <option value="australia">Australia</option>
      <option value="germany">Germany</option>
      <option value="france">France</option>
    </select>
  </label>

  <div id="customOverrides">
    <p><em>Override defaults (optional):</em></p>
    <div class="inline">
      <label>Min Years<input id="minYears" type="number" min="0"/></label>
    </div>
    <div class="inline">
      <label>Max Years<input id="maxYears" type="number" min="0"/></label>
    </div>
    <label><input id="capitalPun" type="checkbox"/> Capital Punishment?</label>
  </div>

  <label>Quantity<input id="qty" type="number" min="1" value="1"/></label>
  <button id="addCrime">Add Crime to Stack</button>

  <!-- Crime Stack -->
  <div id="stack">
    <h3>Crime Stack</h3>
    <table>
      <thead>
        <tr>
          <th>Crime</th><th>Qty</th><th>Years</th><th>Cap</th><th>Fine Range</th><th>Remove</th>
        </tr>
      </thead>
      <tbody id="stackBody"></tbody>
    </table>
    <label><input type="radio" name="mode" value="concurrent" checked/> Concurrent</label>
    <label><input type="radio" name="mode" value="consecutive"/> Consecutive</label>
  </div>

  <button id="calculate">Calculate Sentence & Fines</button>
  <div id="results"></div>

  <!-- Save OC Profiles -->
  <button id="saveOC">üíæ Save OC Profile</button>
  <div id="ocs">
    <h3>Saved OCs</h3>
    <div id="ocList"></div>
  </div>

  <div id="persistMsg">All data saved automatically.</div>
</main>

<script>
  // ‚îÄ‚îÄ‚îÄ Definitions ‚îÄ‚îÄ‚îÄ
  // (categories, labels, defs, defaultRanges stay same, minus removed keys...)

  // New: defaultFines in USD
  const defaultFines = {
    murder: {min:50000, max:200000},
    assault: {min:5000, max:50000},
    kidnapping: {min:20000, max:100000},
    sa: {min:30000, max:150000},
    robbery: {min:10000, max:75000},
    theft: {min:500, max:20000},
    burglary: {min:2000, max:50000},
    arson: {min:5000, max:100000},
    vandalism: {min:200, max:5000},
    embezzlement: {min:10000, max:250000},
    fraud: {min:5000, max:200000},
    moneyLaundering: {min:10000, max:500000},
    taxEvasion: {min:5000, max:200000},
    bribery: {min:5000, max:100000},
    blackmail: {min:2000, max:50000},
    extortion: {min:2000, max:75000},
    espionage: {min:20000, max:100000},
    treason: {min:50000, max:200000},
    terrorism: {min:30000, max:200000},
    sedition: {min:10000, max:50000},
    possession: {min:500, max:20000},
    trafficking: {min:5000, max:100000},
    manufacturing: {min:5000, max:150000},
    publicIntox: {min:100, max:1000},
    prostitution: {min:200, max:5000},
    illegalGambling: {min:500, max:20000},
    trespassCivil: {min:100, max:2000},
    trespassCriminal: {min:500, max:10000},
    speeding: {min:100, max:2000},
    redLight: {min:100, max:1500},
    noise: {min:100, max:2000},
    other: {min:0, max:0}
  };

  // Currency symbols per country
  const currency = {
    '': ['$',1], // world avg use USD
    usa: ['$',1],
    uk: ['¬£',0.8],
    canada: ['C$',1.2],
    australia: ['A$',1.3],
    germany: ['‚Ç¨',0.9],
    france: ['‚Ç¨',0.9]
  };

  // countryMods, legality, categories, labels, defs, defaultRanges remain (minus removed keys)...

  // ‚îÄ‚îÄ‚îÄ State & Persistence ‚îÄ‚îÄ‚îÄ
  let stack = [], ocs = [];
  function saveAll(){
    localStorage.crimeStack = JSON.stringify(stack);
    localStorage.ocsList   = JSON.stringify(ocs);
  }
  function loadAll(){
    stack = JSON.parse(localStorage.crimeStack||'[]');
    ocs   = JSON.parse(localStorage.ocsList||'[]');
    renderStack(); renderOCs();
  }

  // ‚îÄ‚îÄ‚îÄ Element Refs ‚îÄ‚îÄ‚îÄ
  const globalOk    = document.getElementById('globalOk'),
        catEl       = document.getElementById('category'),
        subEl       = document.getElementById('subtype'),
        othEl       = document.getElementById('otherText'),
        ctyEl       = document.getElementById('country'),
        minEl       = document.getElementById('minYears'),
        maxEl       = document.getElementById('maxYears'),
        capEl       = document.getElementById('capitalPun'),
        qtyEl       = document.getElementById('qty'),
        addCrimeBtn = document.getElementById('addCrime'),
        stackBody   = document.getElementById('stackBody'),
        calcBtn     = document.getElementById('calculate'),
        resEl       = document.getElementById('results'),
        resetStackBtn= document.getElementById('resetStack'),
        saveOCBtn    = document.getElementById('saveOC'),
        ocNameIn     = document.getElementById('ocName'),
        ocColorIn    = document.getElementById('ocColor'),
        ocImgIn      = document.getElementById('ocImg'),
        ocListDiv    = document.getElementById('ocList'),
        globalModal  = document.getElementById('globalModal');

  // ‚îÄ‚îÄ‚îÄ Modal ‚îÄ‚îÄ‚îÄ
  window.onload = ()=> globalModal.style.display='flex';
  globalOk.onclick = ()=> globalModal.style.display='none';

  // ‚îÄ‚îÄ‚îÄ Category ‚Üí Subtype Logic (unchanged) ‚îÄ‚îÄ‚îÄ
  // ...

  // ‚îÄ‚îÄ‚îÄ fillOverrides (unchanged) ‚îÄ‚îÄ‚îÄ
  // ...

  // ‚îÄ‚îÄ‚îÄ Add Crime ‚îÄ‚îÄ‚îÄ
  addCrimeBtn.onclick=()=>{
    const c=catEl.value; if(!c) return alert('Select a category');
    let key,label;
    if(c==='other'){
      label=othEl.value.trim()||'[Custom]'; key='other';
    } else {
      key=subEl.value; if(!key) return alert('Select subtype');
      label=labels[key];
    }
    // range overrides already in minEl/maxEl, capture
    stack.push({
      id:Date.now(), key,label,
      qty:+qtyEl.value||1,
      min:+minEl.value||0,
      max:+maxEl.value||0,
      cap:capEl.checked
    });
    saveAll(); renderStack();
  };

  // ‚îÄ‚îÄ‚îÄ Render Stack ‚Äï‚Äï‚Äï
  function renderStack(){
    stackBody.innerHTML='';
    stack.forEach((e,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${e.label}</td>
        <td>${e.qty}</td>
        <td>${e.min}‚Äì${e.max}</td>
        <td>${e.cap?'Yes':'No'}</td>
        <td></td>
        <td><button data-i="${i}">üóëÔ∏è</button></td>`;
      stackBody.appendChild(tr);
    });
    stackBody.querySelectorAll('button').forEach(btn=>{
      btn.onclick=()=>{
        stack.splice(+btn.dataset.i,1);
        saveAll(); renderStack();
      };
    });
  }

  // ‚îÄ‚îÄ‚îÄ Reset ‚Äï‚Äï‚Äï
  resetStackBtn.onclick=()=>{
    if(confirm('Clear current stack?')){
      stack=[]; saveAll(); renderStack(); resEl.innerHTML='';
    }
  };

  // ‚îÄ‚îÄ‚îÄ Calculate ‚Äï‚Äï‚Äï
  calcBtn.onclick=()=>{
    if(!stack.length) return alert('Add at least one crime');
    const mode = document.querySelector('input[name="mode"]:checked').value;
    // sentence
    let tmin=0,tmax=0;
    // fines
    let fmin=0,fmax=0;
    // currency
    const [sym,rate] = currency[ctyEl.value||''];
    stack.forEach(e=>{
      // years
      const mn=e.min*e.qty, mx=e.max*e.qty;
      if(mode==='concurrent'){
        tmin=Math.max(tmin,mn); tmax=Math.max(tmax,mx);
      } else {
        tmin+=mn; tmax+=mx;
      }
      // fines
      const defFine=defaultFines[e.key]||{min:0,max:0};
      const mnF = defFine.min * e.qty * rate;
      const mxF = defFine.max * e.qty * rate;
      if(mode==='concurrent'){
        fmin = Math.max(fmin,mnF);
        fmax = Math.max(fmax,mxF);
      } else {
        fmin+=mnF; fmax+=mxF;
      }
    });
    resEl.innerHTML=`
      <p><strong>Sentence (${mode}):</strong> ${tmin}‚Äì${tmax} years${stack.some(x=>x.cap)?', capital possible':''}.</p>
      <p><strong>Fines:</strong> ${sym}${fmin.toLocaleString()}‚Äì${sym}${fmax.toLocaleString()}</p>
    `;
  };

  // ‚îÄ‚îÄ‚îÄ Save & Render OC Profiles ‚Äï‚Äï‚Äï
  // (unchanged, except it now shows the new results above)

  function renderOCs(){
    ocListDiv.innerHTML='';
    ocs.forEach(o=>{
      const div=document.createElement('div'); div.className='oc-card';
      const h4=document.createElement('h4'); h4.textContent=o.name; div.appendChild(h4);
      if(o.img){
        const img=document.createElement('img'); img.src=o.img; div.appendChild(img);
      } else {
        const ph=document.createElement('div'); ph.className='placeholder';
        ph.style.background=o.color; ph.textContent='No Image'; div.appendChild(ph);
      }
      const delBtn=document.createElement('button');
      delBtn.textContent='üóëÔ∏è Delete'; delBtn.className='deleteOC';
      delBtn.onclick=()=>{
        ocs=ocs.filter(x=>x.id!==o.id);
        saveAll(); renderOCs();
      };
      div.appendChild(delBtn);

      // summary & table
      const sum=document.createElement('div');
      sum.className='oc-summary';
      sum.innerHTML=o.summary;
      div.appendChild(sum);

      const tbl=document.createElement('table');
      tbl.innerHTML='<thead><tr><th>Crime</th><th>Qty</th><th>Years</th><th>Fine</th></tr></thead>';
      const tb=document.createElement('tbody');
      o.crimes.forEach(c=>{
        const defFine=defaultFines[c.key]||{min:0,max:0};
        const fineMin=defFine.min*c.qty, fineMax=defFine.max*c.qty;
        const row=document.createElement('tr');
        row.innerHTML=`
          <td>${c.label}</td>
          <td>${c.qty}</td>
          <td>${c.min}‚Äì${c.max}</td>
          <td>${sym}${(fineMin*rate).toLocaleString()}‚Äì${sym}${(fineMax*rate).toLocaleString()}</td>
        `;
        tb.appendChild(row);
      });
      tbl.appendChild(tb);
      div.appendChild(tbl);

      ocListDiv.appendChild(div);
    });
  }

  // ‚îÄ‚îÄ‚îÄ OC Save Handler ‚Äï‚Äï‚Äï
  saveOCBtn.onclick=()=>{
    const name=ocNameIn.value.trim();
    if(!name) return alert('Enter an OC name');
    function pushOC(imgData){
      calcBtn.onclick(); // recalc to populate resEl
      ocs.push({
        id:Date.now(),
        name, img:imgData, color:ocColorIn.value,
        crimes: JSON.parse(JSON.stringify(stack)),
        summary: resEl.innerHTML
      });
      saveAll(); renderOCs();
      stack=[]; saveAll(); renderStack(); resEl.innerHTML='';
      ocNameIn.value=''; ocImgIn.value='';
    }
    if(ocImgIn.files[0]){
      const fr=new FileReader();
      fr.onload=e=> pushOC(e.target.result);
      fr.readAsDataURL(ocImgIn.files[0]);
    } else {
      pushOC(null);
    }
  };

  // ‚îÄ‚îÄ‚îÄ Initialize ‚îÄ‚îÄ‚îÄ
  loadAll();
  if(catEl.value) catEl.onchange();
  if(subEl.value) fillOverrides();
</script>

</body>
</html>
