<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OC Timeline Manager</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <!-- vis-timeline CSS -->
  <link 
    href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" 
    rel="stylesheet" />
  <style>
    body { margin:0; font-family:Arial,sans-serif; height:100vh; display:flex; flex-direction:column; }
    #controls { padding:8px; background:#f4f4f4; border-bottom:1px solid #ccc; }
    #controls button { margin-right:8px; }
    #timeline { flex:1; }
  </style>
</head>
<body>

  <div id="controls">
    <button id="btnZoomIn">🔍+</button>
    <button id="btnZoomOut">🔍–</button>
    <button id="btnFit">⏹ Fit</button>
  </div>
  <div id="timeline"></div>

  <!-- vis-timeline library -->
  <script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <script>
    // Load / Save to localStorage
    const STORAGE_KEY = 'oc_tl_events';
    let events = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
    }

    // Create a vis DataSet
    const items = new vis.DataSet(events);

    // Timeline options: pan, zoom, nav buttons, keyboard shortcuts
    const options = {
      editable: {
        add: true,
        updateTime: true,
        updateGroup: false,
        remove: true
      },
      interaction: {
        dragView: true,
        zoomKey: 'ctrlKey'   // zoom only when holding Ctrl :contentReference[oaicite:2]{index=2}
      },
      navigation: {
        enabled: true        // show built-in pan/zoom/reset buttons :contentReference[oaicite:3]{index=3}
      },
      keyboard: {
        enabled: true,       // allow keyboard arrows & +/- for pan/zoom :contentReference[oaicite:4]{index=4}
        speed: { x: 10, y: 1, zoom: 0.1 }
      },
      orientation: 'bottom',
      moment: date => vis.moment(date).utc()
    };

    // Initialize
    const container = document.getElementById('timeline');
    const timeline = new vis.Timeline(container, items, options);

    // Event handlers: add / change / remove
    timeline.on('add', (props, callback) => {
      const content = prompt('Event title:');
      if (!content) return callback(null);
      const dateStr = prompt('Date (YYYY-MM-DD):', props.start.toISOString().slice(0,10));
      const start = dateStr ? new Date(dateStr) : props.start;
      const newItem = { id: Date.now(), content, start };
      items.add(newItem);
      events.push(newItem);
      save();
      callback(newItem);
    });

    timeline.on('change', (props, callback) => {
      props.items.forEach(id => {
        const updated = items.get(id);
        const idx = events.findIndex(e => e.id === id);
        if (idx !== -1) events[idx] = updated;
      });
      save();
      callback(props);
    });

    timeline.on('remove', (props, callback) => {
      props.items.forEach(id => {
        events = events.filter(e => e.id !== id);
      });
      save();
      callback(props);
    });

    // Wire up our own zoom buttons
    document.getElementById('btnZoomIn').onclick  = () => timeline.zoomIn();
    document.getElementById('btnZoomOut').onclick = () => timeline.zoomOut();
    document.getElementById('btnFit').onclick     = () => timeline.fit();
  </script>
</body>
</html>
