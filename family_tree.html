<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree Builder (Interactive)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- vis.js CSS -->
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #topbar { padding: 10px; background: #444; color: #fff; display: flex; align-items: center; }
    #topbar input, #topbar button { margin-left: 10px; padding: 6px; }
    #mynetwork { width: 100%; height: calc(100vh - 48px); background: #f9f9f9; }
  </style>
</head>
<body>
  <div id="topbar">
    <strong>OC Family Tree Builder</strong>
    <input type="text" id="newName" placeholder="Character Name" />
    <button id="addNode">Add Character</button>
    <span style="margin-left:auto;font-size:0.9em;">Drag nodes; connect by dragging arrow from one node to another.</span>
  </div>
  <div id="mynetwork"></div>

  <!-- vis.js library -->
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script>
    // Data sets
    const nodes = new vis.DataSet();
    const edges = new vis.DataSet();

    // Network options
    const container = document.getElementById('mynetwork');
    const data = { nodes, edges };
    const options = {
      nodes: {
        shape: 'box',
        margin: 10,
        color: { background: '#fff', border: '#444' },
      },
      edges: {
        arrows: { to: { enabled: true, type: 'arrow' } },
        smooth: { type: 'cubicBezier', forceDirection: 'vertical', roundness: 0.4 },
      },
      interaction: {
        dragNodes: true,
        dragView: true,
        multiselect: true,
        navigationButtons: true
      },
      layout: { hierarchical: false }
    };
    const network = new vis.Network(container, data, options);

    // Add new character as a node
    document.getElementById('addNode').onclick = () => {
      const name = document.getElementById('newName').value.trim();
      if (!name) return alert('Enter a name!');
      const id = nodes.length + 1;
      nodes.add({ id, label: name });
      document.getElementById('newName').value = '';
    };

    // On dragging from one node to another, create an edge
    network.on('dragEnd', params => {
      // no-op
    });

    // Enable edge creation by dragging: use built-in heldDownForDrag
    network.on('startStabilizing', () => {}); // needed to initialize
    network.on('selectNode', params => {
      // Prepare for edge creation: when the user ctrl+drags from a node
      // vis.js 9.x+ supports 'manipulation' but for simplicity, we allow
      // right-click-drag or ctrl+drag during edge edit mode:
    });

    // Turn on built-in edge creation UI
    network.setOptions({
      manipulation: {
        enabled: true,
        addEdge: (edgeData, callback) => {
          // Allow loops and multiple edges
          callback(edgeData);
        },
        deleteNode: true,
        deleteEdge: true
      }
    });
  </script>
</body>
</html>
