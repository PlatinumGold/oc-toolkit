<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crime Sentence & Fine Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: Arial, sans-serif; margin:0; }
    header { background:#c0392b; color:#fff; padding:16px; text-align:center; font-size:1.5em; }
    main { max-width:800px; margin:20px auto; padding:0 16px; }
    h2 { margin-top:24px; }
    label { display:block; margin-top:12px; }
    select, input[type="number"], input[type="text"], input[type="color"] {
      width:100%; padding:8px; box-sizing:border-box; margin-top:4px;
    }
    .inline { display:inline-block; width:48%; vertical-align:top; }
    .inline + .inline { margin-left:4%; }
    button, input[type="button"] {
      margin-top:16px; padding:10px 20px;
      background:#c0392b; color:#fff; border:none; cursor:pointer; font-size:1em;
    }
    #globalModal {
      display:none; position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center;
      z-index:1000;
    }
    #globalModal .modal {
      background:#fff; padding:20px; border-radius:6px;
      max-width:400px; text-align:center;
    }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { border:1px solid #ccc; padding:6px; text-align:left; }
    #results, .oc-summary { margin-top:20px; padding:12px; background:#eef; border-radius:4px; }
    .oc-card {
      border:2px solid #c0392b; border-radius:6px; padding:10px;
      display:inline-block; width:240px; margin:8px; vertical-align:top; position: relative;
    }
    .oc-card img, .oc-card .placeholder {
      width:100%; height:120px; object-fit:cover; background:#ddd;
      display:flex; align-items:center; justify-content:center; color:#666;
    }
    .oc-card button.deleteOC {
      position: absolute; top:8px; right:8px; background:#c0392b; color:#fff;
      border:none; padding:4px 8px; cursor:pointer;
    }
    #persistMsg { font-size:.9em; color:#666; margin-top:8px; }
  </style>
</head>
<body>

<header>‚öñÔ∏è Crime Sentence & Fine Calculator</header>

<div id="globalModal">
  <div class="modal">
    <p><strong>Trigger Warning:</strong><br>
       This tool covers sensitive criminal content.<br>
       Click ‚ÄúI Understand‚Äù to proceed.</p>
    <button id="globalOk">I Understand</button>
  </div>
</div>

<main>
  <h2>‚ñ∂Ô∏è Current OC</h2>
  <label>OC Name<input id="ocName" type="text" placeholder="Character Name‚Ä¶"/></label>
  <label>Placeholder Color<input id="ocColor" type="color" value="#dddddd"/></label>
  <label>OC Image<input id="ocImg" type="file" accept="image/*"/></label>
  <button id="resetStack">üîÑ Reset Current Stack</button>

  <h2>‚ûï Add Crime</h2>
  <label>Crime Category
    <select id="category">
      <option value="">‚Äî Select ‚Äî</option>
      <optgroup label="Violent Crimes">
        <option value="murder">Murder</option>
        <option value="assault">Assault</option>
        <option value="kidnapping">Kidnapping</option>
        <option value="sa">Sexual Violence</option>
        <option value="robbery">Robbery</option>
      </optgroup>
      <optgroup label="Property Crimes">
        <option value="theft">Theft</option>
        <option value="burglary">Burglary</option>
        <option value="arson">Arson</option>
        <option value="vandalism">Vandalism</option>
        <option value="embezzlement">Embezzlement</option>
      </optgroup>
      <optgroup label="White-Collar Crimes">
        <option value="fraud">Fraud</option>
        <option value="moneyLaundering">Money Laundering</option>
        <option value="taxEvasion">Tax Evasion</option>
        <option value="bribery">Bribery</option>
        <option value="blackmail">Blackmail</option>
        <option value="extortion">Extortion</option>
      </optgroup>
      <optgroup label="Political Crimes">
        <option value="espionage">Espionage</option>
        <option value="treason">Treason</option>
        <option value="terrorism">Terrorism</option>
        <option value="sedition">Sedition</option>
      </optgroup>
      <optgroup label="Drug-Related Crimes">
        <option value="possession">Possession (Class A/B/C)</option>
        <option value="trafficking">Trafficking</option>
        <option value="manufacturing">Manufacturing</option>
      </optgroup>
      <optgroup label="Public Order">
        <option value="publicIntox">Public Intoxication</option>
        <option value="prostitution">Prostitution</option>
        <option value="illegalGambling">Illegal Gambling</option>
      </optgroup>
      <optgroup label="Petty Crimes">
        <option value="trespassCivil">Civil Trespass</option>
        <option value="trespassCriminal">Criminal Trespass</option>
        <option value="pickpocket">Pickpocketing</option>
        <option value="shoplifting">Shoplifting</option>
        <option value="disorderly">Disorderly Conduct</option>
      </optgroup>
      <option value="other">Other‚Ä¶</option>
    </select>
  </label>

  <label>Subtype
    <select id="subtype" disabled><option>‚Äî</option></select>
  </label>
  <input id="otherText" type="text" placeholder="Custom crime‚Ä¶" style="display:none"/>

  <label>Country
    <select id="country">
      <option value="">Default (World Avg)</option>
      <option value="usa">USA</option>
      <option value="uk">UK</option>
      <option value="canada">Canada</option>
      <option value="australia">Australia</option>
      <option value="germany">Germany</option>
      <option value="france">France</option>
    </select>
  </label>

  <div id="customOverrides">
    <p><em>Override defaults:</em></p>
    <div class="inline">
      <label>Min Years<input id="minYears" type="number" min="0"></label>
    </div>
    <div class="inline">
      <label>Max Years<input id="maxYears" type="number" min="0"></label>
    </div>
    <label><input id="capitalPun" type="checkbox"> Capital Punishment?</label>
  </div>

  <label>Quantity<input id="qty" type="number" min="1" value="1"/></label>
  <button id="addCrime">Add Crime to Stack</button>

  <div id="stack">
    <h3>Crime Stack</h3>
    <table>
      <thead>
        <tr>
          <th>Crime</th><th>Qty</th><th>Years</th><th>Cap</th><th>Fine</th><th>Remove</th>
        </tr>
      </thead>
      <tbody id="stackBody"></tbody>
    </table>
    <label><input type="radio" name="mode" value="concurrent" checked> Concurrent</label>
    <label><input type="radio" name="mode" value="consecutive"> Consecutive</label>
  </div>

  <button id="calculate">Calculate Sentence & Fines</button>
  <div id="results"></div>

  <button id="saveOC">üíæ Save OC Profile</button>
  <div id="ocs">
    <h3>Saved OCs</h3>
    <div id="ocList"></div>
  </div>

  <div id="persistMsg">All data saved automatically.</div>
</main>

<script>
  // ‚îÄ‚îÄ Data definitions ‚îÄ‚îÄ
  const categories = {
    murder: ['first','second','voluntary','involuntary'],
    assault: ['simple','aggravated'],
    kidnapping: ['parental','stranger','falseImp'],
    sa: ['rape','statutory','sexualAssault','incest','grooming','sexualExtortion'],
    robbery: ['armed','strongArm'],
    theft: ['larceny','petty','grandAuto'],
    burglary: ['residential','commercial'],
    arson: ['firstA','secondA'],
    vandalism: ['graffiti','malicious'],
    embezzlement: ['employee','corporate'],
    fraud: ['bank','insurance','election'],
    moneyLaundering: ['structuring','shell'],
    taxEvasion: ['falsify','offshore'],
    bribery: ['public','commercialBribery'],
    blackmail: ['blackmail'],
    extortion: ['extortion'],
    espionage: ['gov','corp','residentialEsp','nuclear'],
    treason: ['aiding','levying'],
    terrorism: ['domestic','international'],
    sedition: ['sedition'],
    possession: ['classA','classB','classC'],
    trafficking: ['large','street'],
    manufacturing: ['methLab','growOp'],
    publicIntox: ['publicIntox'],
    prostitution: ['prostitution'],
    illegalGambling: ['underground','sportsBook'],
    trespassCivil: ['trespassCivil'],
    trespassCriminal: ['trespassCriminal'],
    pickpocket: ['pickpocket'],
    shoplifting: ['shoplifting'],
    disorderly: ['disorderly'],
    other: []
  };

  // labels with slightly richer descriptions
  const labels = {
    first:'1st-Degree Murder',
    second:'2nd-Degree Murder',
    voluntary:'Voluntary Manslaughter',
    involuntary:'Involuntary Manslaughter',
    simple:'Simple Assault',
    aggravated:'Aggravated Assault',
    parental:'Parental Abduction',
    stranger:'Stranger Abduction',
    falseImp:'False Imprisonment',
    rape:'Rape (Non-Consensual Intercourse)',
    statutory:'Statutory Rape (Minor)',
    sexualAssault:'Sexual Assault (Non-Consensual Act)',
    incest:'Incest (Close Relatives)',
    grooming:'Grooming (Enticement of Minor)',
    sexualExtortion:'Sexual Extortion (Threats for Acts)',
    armed:'Armed Robbery (Weapon Used)',
    strongArm:'Strong-arm Robbery (By Force)',
    larceny:'Larceny (Stealing Personal Property)',
    petty:'Petty Theft (Low-Value Property)',
    grandAuto:'Grand Theft Auto (Vehicle Theft)',
    residential:'Residential Burglary (Home Break-In)',
    commercial:'Commercial Burglary (Business Break-In)',
    firstA:'1st-Degree Arson (Willful Burning)',
    secondA:'2nd-Degree Arson (Less Severe)',
    graffiti:'Graffiti (Unauthorized Spraying)',
    malicious:'Malicious Destruction of Property',
    employee:'Employee Embezzlement (Funds Misuse)',
    corporate:'Corporate Embezzlement (Large-Scale)',
    bank:'Bank Fraud (Deceptive Schemes)',
    insurance:'Insurance Fraud (False Claims)',
    election:'Election Fraud (Manipulating Votes)',
    structuring:'Structuring (Avoid Reporting)',
    shell:'Shell Company Money Laundering',
    falsify:'Tax Falsification (False Returns)',
    offshore:'Offshore Accounts (Hide Money)',
    public:'Bribery of Public Official',
    commercialBribery:'Commercial Bribery',
    blackmail:'Blackmail (Threats for Gain)',
    extortion:'Extortion (Force/Threats for Gain)',
    gov:'Espionage for State Secrets',
    corp:'Corporate Espionage (Trade Secrets)',
    residentialEsp:'Residential Espionage (Home Bugging)',
    nuclear:'Nuclear Espionage (Weapons Data)',
    aiding:'Aiding an Enemy State',
    levying:'Levying War (Rebellion)',
    domestic:'Domestic Terrorism (Political Violence)',
    international:'International Terrorism (Cross-Border)',
    sedition:'Sedition (Inciting Rebellion)',
    classA:'Possession Class A Drugs',
    classB:'Possession Class B Drugs',
    classC:'Possession Class C Drugs',
    large:'Large-Scale Drug Trafficking',
    street:'Street-Level Drug Dealing',
    methLab:'Meth Lab Manufacture',
    growOp:'Illegal Cannabis Cultivation',
    publicIntox:'Public Intoxication (Drunk in Public)',
    prostitution:'Prostitution (Selling Sex)',
    underground:'Underground Gambling',
    sportsBook:'Sports Bookmaking Illegally',
    trespassCivil:'Civil Trespass',
    trespassCriminal:'Criminal Trespass',
    pickpocket:'Pickpocketing (Steal from Pockets)',
    shoplifting:'Shoplifting (Retail Theft)',
    disorderly:'Disorderly Conduct (Disturbance)',
    other:'Custom Crime'
  };

  // longer definitions for the stack
  const defs = {
    '1st-Degree Murder':'A deliberate, premeditated killing with intent.',
    '2nd-Degree Murder':'Intentional killing without prior planning.',
    'Voluntary Manslaughter':'A killing in the ‚Äúheat of passion‚Äù under provocation.',
    'Involuntary Manslaughter':'An unintentional killing due to reckless or negligent actions.',
    'Simple Assault':'Causing fear or minor physical harm without a weapon.',
    'Aggravated Assault':'Serious bodily injury inflicted or a weapon used.',
    'Rape (Non-Consensual Intercourse)':'Sexual penetration without consent.',
    'Statutory Rape (Minor)':'Sexual activity with someone below the age of consent.',
    'Sexual Assault (Non-Consensual Act)':'Any unwanted sexual touching or behavior.',
    'Incest (Close Relatives)':'Sexual activity between family members.',
    'Grooming (Enticement of Minor)':'Building trust to facilitate sexual abuse of a minor.',
    'Sexual Extortion (Threats for Acts)':'Forcing sexual acts through coercion or threats.',
    'Armed Robbery (Weapon Used)':'Taking property by force while armed.',
    'Strong-arm Robbery (By Force)':'Theft by force without a weapon.',
    'Larceny (Stealing Personal Property)':'Taking someone else‚Äôs property without consent.',
    'Petty Theft (Low-Value Property)':'Theft of property below a statutory value.',
    'Grand Theft Auto (Vehicle Theft)':'The illegal taking of someone‚Äôs motor vehicle.',
    'Residential Burglary (Home Break-In)':'Unlawful entry into a dwelling to commit a crime.',
    'Commercial Burglary (Business Break-In)':'Breaking into a non-residential structure to commit a crime.',
    '1st-Degree Arson (Willful Burning)':'Deliberate setting of fire to property with intent.',
    '2nd-Degree Arson (Less Severe)':'Reckless burning without proof of intent.',
    'Graffiti (Unauthorized Spraying)':'Applying spray paint or markings without permission.',
    'Malicious Destruction of Property':'Intentionally damaging someone else‚Äôs property.',
    'Employee Embezzlement (Funds Misuse)':'Fraudulent taking of funds by an employee.',
    'Corporate Embezzlement (Large-Scale)':'High-level misappropriation of corporate assets.',
    'Bank Fraud (Deceptive Schemes)':'Using deceit to obtain money or assets from a bank.',
    'Insurance Fraud (False Claims)':'Falsely claiming insurance benefits for gain.',
    'Election Fraud (Manipulating Votes)':'Dishonest practices to alter election results.',
    'Structuring (Avoid Reporting)':'Breaking transactions to evade financial reporting.',
    'Shell Company Money Laundering':'Using front companies to conceal the origin of funds.',
    'Tax Falsification (False Returns)':'Intentionally filing incorrect tax information.',
    'Offshore Accounts (Hide Money)':'Concealing assets in foreign jurisdictions to avoid taxes.',
    'Bribery of Public Official':'Offering money or favors to influence an official act.',
    'Commercial Bribery':'Offering or accepting something of value in a business context.',
    'Blackmail (Threats for Gain)':'Threatening to reveal secrets for money or favors.',
    'Extortion (Force/Threats for Gain)':'Obtaining property by coercion or threats.',
    'Espionage for State Secrets':'Spying to obtain government intelligence.',
    'Corporate Espionage (Trade Secrets)':'Stealing proprietary business information.',
    'Residential Espionage (Home Bugging)':'Illegally installing surveillance in private homes.',
    'Nuclear Espionage (Weapons Data)':'Stealing classified nuclear or defense information.',
    'Aiding an Enemy State':'Providing assistance to a foreign adversary.',
    'Levying War (Rebellion)':'Actively waging war against one‚Äôs own government.',
    'Domestic Terrorism (Political Violence)':'Violent acts intended to intimidate a civilian population.',
    'International Terrorism (Cross-Border)':'Violent acts spanning national boundaries.',
    'Sedition (Inciting Rebellion)':'Encouraging resistance against lawful authority.',
    'Possession Class A Drugs':'Holding high-risk substances like heroin or cocaine.',
    'Possession Class B Drugs':'Holding substances like amphetamines under regulation.',
    'Possession Class C Drugs':'Holding lower-risk controlled substances, e.g. tranquilizers.',
    'Large-Scale Drug Trafficking':'Operating major distribution networks for illicit drugs.',
    'Street-Level Drug Dealing':'Selling small quantities of drugs to consumers.',
    'Meth Lab Manufacture':'Producing methamphetamine in clandestine labs.',
    'Illegal Cannabis Cultivation':'Growing cannabis without proper authorization.',
    'Public Intoxication (Drunk in Public)':'Being visibly drunk in a public space.',
    'Prostitution (Selling Sex)':'Exchanging sexual services for money or goods.',
    'Underground Gambling':'Operating or participating in unlicensed betting activities.',
    'Sports Bookmaking Illegally':'Taking or placing bets on sports events outside licensed venues.',
    'Civil Trespass':'Entering property without permission (civil offense).',
    'Criminal Trespass':'Entering or remaining in property with intent to commit a crime.',
    'Pickpocketing (Steal from Pockets)':'Stealing from a person‚Äôs clothing or bag.',
    'Shoplifting (Retail Theft)':'Stealing merchandise from a retail establishment.',
    'Disorderly Conduct (Disturbance)':'Engaging in disruptive behavior in public.',
    'Custom Crime':'A user-defined offense not covered above.'
  };

  const defaultRanges = { /* as before‚Ä¶ */ };
  const defaultFines = {
    murder:{min:50000,max:200000}, assault:{min:5000,max:50000},
    kidnapping:{min:20000,max:100000}, sa:{min:30000,max:150000},
    robbery:{min:10000,max:75000}, theft:{min:500,max:20000},
    burglary:{min:2000,max:50000}, arson:{min:5000,max:100000},
    vandalism:{min:200,max:5000}, embezzlement:{min:10000,max:250000},
    fraud:{min:5000,max:200000}, moneyLaundering:{min:10000,max:500000},
    taxEvasion:{min:5000,max:200000}, bribery:{min:5000,max:100000},
    blackmail:{min:2000,max:50000}, extortion:{min:2000,max:75000},
    espionage:{min:20000,max:100000}, treason:{min:50000,max:200000},
    terrorism:{min:30000,max:200000}, sedition:{min:10000,max:50000},
    possession:{min:500,max:20000}, trafficking:{min:5000,max:100000},
    manufacturing:{min:5000,max:150000}, publicIntox:{min:100,max:1000},
    prostitution:{min:200,max:5000}, illegalGambling:{min:500,max:20000},
    trespassCivil:{min:100,max:2000}, trespassCriminal:{min:500,max:10000},
    pickpocket:{min:500,max:5000}, shoplifting:{min:500,max:10000},
    disorderly:{min:100,max:2000}, other:{min:0,max:0}
  };

  const countryMods = {
    usa:{minMul:1.1,maxMul:1.2}, uk:{minMul:0.9,maxMul:0.95},
    canada:{minMul:0.8,maxMul:0.9}, australia:{minMul:0.85,maxMul:0.95},
    germany:{minMul:0.7,maxMul:0.8}, france:{minMul:0.8,maxMul:0.9}
  };
  const legality = { /* same as before‚Ä¶ */ };
  const currency = {
    '':['$',1], usa:['$',1], uk:['¬£',0.8],
    canada:['C$',1.2], australia:['A$',1.3],
    germany:['‚Ç¨',0.9], france:['‚Ç¨',0.9]
  };

  // ‚îÄ‚îÄ State & Persistence ‚îÄ‚îÄ
  let stack = [], ocs = [];
  function saveAll(){
    localStorage.crimeStack = JSON.stringify(stack);
    localStorage.ocsList   = JSON.stringify(ocs);
  }
  function loadAll(){
    stack = JSON.parse(localStorage.crimeStack||'[]');
    ocs   = JSON.parse(localStorage.ocsList||'[]');
    renderStack(); renderOCs();
  }

  // ‚îÄ‚îÄ Element Refs ‚îÄ‚îÄ
  const globalOk    = document.getElementById('globalOk'),
        catEl       = document.getElementById('category'),
        subEl       = document.getElementById('subtype'),
        othEl       = document.getElementById('otherText'),
        ctyEl       = document.getElementById('country'),
        minEl       = document.getElementById('minYears'),
        maxEl       = document.getElementById('maxYears'),
        capEl       = document.getElementById('capitalPun'),
        qtyEl       = document.getElementById('qty'),
        addCrimeBtn = document.getElementById('addCrime'),
        stackBody   = document.getElementById('stackBody'),
        calcBtn     = document.getElementById('calculate'),
        resEl       = document.getElementById('results'),
        resetStack  = document.getElementById('resetStack'),
        saveOCBtn   = document.getElementById('saveOC'),
        ocNameIn    = document.getElementById('ocName'),
        ocColorIn   = document.getElementById('ocColor'),
        ocImgIn     = document.getElementById('ocImg'),
        ocListDiv   = document.getElementById('ocList'),
        globalModal = document.getElementById('globalModal');

  // ‚îÄ‚îÄ Global Modal ‚îÄ‚îÄ
  window.onload = ()=> globalModal.style.display = 'flex';
  globalOk.onclick = ()=> globalModal.style.display = 'none';

  // ‚îÄ‚îÄ Category ‚Üí Subtype ‚îÄ‚îÄ
  catEl.onchange = ()=> {
    const c = catEl.value;
    subEl.disabled = true;
    subEl.innerHTML = '';
    othEl.style.display = 'none';
    if (!c) return;
    if (c === 'other') {
      othEl.style.display = 'block';
      return;
    }
    const opts = categories[c] || [];
    if (!opts.length) return;
    subEl.disabled = false;
    subEl.innerHTML = '<option value="">‚Äî Select subtype ‚Äî</option>';
    opts.forEach(k => {
      const o = document.createElement('option');
      o.value = k; o.textContent = labels[k];
      subEl.appendChild(o);
    });
  };

  // ‚îÄ‚îÄ Fill Overrides ‚îÄ‚îÄ
  function fillOverrides(){
    let key = subEl.value || 'other';
    if (catEl.value==='other') key='other';
    if (!key) return;
    let r = defaultRanges[key] || {min:0,max:0,cap:false};
    if (ctyEl.value && legality[ctyEl.value] && !legality[ctyEl.value].has(key)) {
      r = {min:0,max:0,cap:false};
    } else if (ctyEl.value) {
      const m = countryMods[ctyEl.value];
      r = {min: Math.round(r.min*m.minMul), max: Math.round(r.max*m.maxMul), cap: r.cap};
    }
    minEl.value = r.min;
    maxEl.value = r.max;
    capEl.checked = r.cap;
  }
  subEl.onchange = fillOverrides;
  ctyEl.onchange = fillOverrides;

  // ‚îÄ‚îÄ Add Crime ‚îÄ‚îÄ
  addCrimeBtn.onclick = ()=>{
    const c = catEl.value;
    if (!c) return alert('Select a category');
    let key,label;
    if (c==='other') {
      key='other'; label=othEl.value.trim()||'Custom Crime';
    } else {
      key = subEl.value;
      if (!key) return alert('Select subtype');
      label = labels[key];
    }
    stack.push({
      id: Date.now(), key, label,
      qty: +qtyEl.value||1,
      min: +minEl.value||0,
      max: +maxEl.value||0,
      cap: capEl.checked
    });
    saveAll();
    renderStack();
  };

  // ‚îÄ‚îÄ Render Stack ‚îÄ‚îÄ
  function renderStack() {
    stackBody.innerHTML = '';
    const [sym, rate] = currency[ctyEl.value||''];
    stack.forEach((e,i) => {
      // fines
      const df = defaultFines[e.key]||{min:0,max:0};
      const mnF = Math.round(df.min*e.qty*rate),
            mxF = Math.round(df.max*e.qty*rate);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${e.label}<br>
            <small>${defs[e.label]||''}</small>
        </td>
        <td>${e.qty}</td>
        <td>${e.min}‚Äì${e.max}</td>
        <td>${e.cap?'Yes':'No'}</td>
        <td>${sym}${mnF.toLocaleString()}‚Äì${sym}${mxF.toLocaleString()}</td>
        <td><button data-i="${i}">üóëÔ∏è</button></td>
      `;
      stackBody.appendChild(tr);
    });
    stackBody.querySelectorAll('button').forEach(btn=>{
      btn.onclick = ()=>{
        stack.splice(+btn.dataset.i,1);
        saveAll(); renderStack();
      };
    });
  }

  // ‚îÄ‚îÄ Reset ‚îÄ‚îÄ
  resetStack.onclick = ()=>{
    if (confirm('Clear current stack?')) {
      stack=[]; saveAll(); renderStack(); resEl.innerHTML='';
    }
  };

  // ‚îÄ‚îÄ Calculate ‚îÄ‚îÄ
  calcBtn.onclick = ()=>{
    if (!stack.length) return alert('Add at least one crime');
    const mode = document.querySelector('input[name="mode"]:checked').value;
    let tmin=0, tmax=0, fmin=0, fmax=0;
    const [sym, rate] = currency[ctyEl.value||''];
    stack.forEach(e=>{
      const mn = e.min*e.qty, mx = e.max*e.qty;
      if (mode==='concurrent'){
        tmin = Math.max(tmin,mn);
        tmax = Math.max(tmax,mx);
      } else {
        tmin += mn;
        tmax += mx;
      }
      const df = defaultFines[e.key]||{min:0,max:0};
      const mnF = df.min*e.qty*rate, mxF = df.max*e.qty*rate;
      if (mode==='concurrent'){
        fmin = Math.max(fmin,mnF);
        fmax = Math.max(fmax,mxF);
      } else {
        fmin += mnF;
        fmax += mxF;
      }
    });
    resEl.innerHTML = `
      <p><strong>Sentence (${mode}):</strong>
         ${tmin}‚Äì${tmax} years${stack.some(x=>x.cap)?', capital possible':''}.
      </p>
      <p><strong>Fines:</strong>
         ${sym}${fmin.toLocaleString()}‚Äì${sym}${fmax.toLocaleString()}
      </p>
    `;
  };

  // ‚îÄ‚îÄ Save & Render OCs ‚îÄ‚îÄ
  saveOCBtn.onclick = ()=>{
    const name = ocNameIn.value.trim();
    if (!name) return alert('Enter OC name');
    function pushOC(img){
      calcBtn.onclick();
      ocs.push({
        id: Date.now(),
        name, img,
        color: ocColorIn.value,
        crimes: JSON.parse(JSON.stringify(stack)),
        summary: resEl.innerHTML
      });
      saveAll(); renderOCs();
      stack=[]; saveAll(); renderStack(); resEl.innerHTML='';
      ocNameIn.value=''; ocImgIn.value='';
    }
    if (ocImgIn.files[0]){
      const fr = new FileReader();
      fr.onload = e=> pushOC(e.target.result);
      fr.readAsDataURL(ocImgIn.files[0]);
    } else pushOC(null);
  };

  function renderOCs(){
    ocListDiv.innerHTML = '';
    ocs.forEach(o=>{
      const div = document.createElement('div');
      div.className = 'oc-card';
      const h4 = document.createElement('h4');
      h4.textContent = o.name;
      div.appendChild(h4);
      if (o.img){
        const img = document.createElement('img');
        img.src = o.img;
        div.appendChild(img);
      } else {
        const ph = document.createElement('div');
        ph.className = 'placeholder';
        ph.style.background = o.color;
        ph.textContent = 'No Image';
        div.appendChild(ph);
      }
      const del = document.createElement('button');
      del.textContent = 'üóëÔ∏è Delete';
      del.className = 'deleteOC';
      del.onclick = ()=>{
        ocs = ocs.filter(x=>x.id!==o.id);
        saveAll(); renderOCs();
      };
      div.appendChild(del);

      const sum = document.createElement('div');
      sum.className = 'oc-summary';
      sum.innerHTML = o.summary;
      div.appendChild(sum);

      // table of crimes
      const tbl = document.createElement('table');
      tbl.innerHTML = `<thead><tr>
        <th>Crime</th><th>Qty</th><th>Years</th><th>Fine</th>
      </tr></thead>`;
      const tb = document.createElement('tbody');
      const [sym,rate] = currency[ctyEl.value||''];
      o.crimes.forEach(c=>{
        const df = defaultFines[c.key]||{min:0,max:0};
        const mnF = Math.round(df.min*c.qty*rate);
        const mxF = Math.round(df.max*c.qty*rate);
        const r = document.createElement('tr');
        r.innerHTML = `
          <td>${c.label}</td>
          <td>${c.qty}</td>
          <td>${c.min}‚Äì${c.max}</td>
          <td>${sym}${mnF.toLocaleString()}‚Äì${sym}${mxF.toLocaleString()}</td>
        `;
        tb.appendChild(r);
      });
      tbl.appendChild(tb);
      div.appendChild(tbl);

      ocListDiv.appendChild(div);
    });
  }

  // ‚îÄ‚îÄ Initialize ‚îÄ‚îÄ
  loadAll();
</script>

</body>
</html>
