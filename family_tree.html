<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OC Family Tree</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f5;
      margin: 0;
    }
    #header {
      background: #446688;
      color: #fff;
      padding: 10px;
      text-align: center;
      font-size: 1.2em;
    }
    #toolbar {
      background: #fff;
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }
    #toolbar button {
      margin: 0 5px;
      padding: 5px 10px;
      font-size: 0.9em;
      cursor: pointer;
    }
    #treeContainer {
      position: relative;
      height: calc(100vh - 80px);
      overflow: auto;         /* allow scrolling */
      padding: 20px;
    }
    .tree { display: flex; flex-direction: column; align-items: center; }
    .row  { display: flex; justify-content: center; align-items: center; }
    .node {
      background: #fff;
      border: 2px solid #446688; /* splash of color */
      padding: 8px;
      margin: 10px;
      min-width: 120px;
      text-align: center;
      border-radius: 6px;
      position: relative;
    }
    .node .fields {
      margin-bottom: 6px;
    }
    .node .fields input,
    .node .fields select,
    .node .fields textarea {
      width: 90%;
      margin: 2px 0;
      padding: 4px;
      font-size: 0.85em;
    }
    .buttons { margin-top: 6px; }
    .buttons button {
      margin: 2px;
      padding: 3px 6px;
      font-size: 0.8em;
      cursor: pointer;
    }
    .line-vert {
      width: 2px;
      height: 20px;
      background: #000;
      margin: auto;
    }
    .line-horiz {
      height: 2px;
      flex: 1;
      background: #000;
      margin: 0 5px;
    }
  </style>
</head>
<body>
  <div id="header">ðŸ§¬ OC Family Tree</div>
  <div id="toolbar">
    <button id="addRelTypeBtn">+ Add Rel Type</button>
  </div>
  <div id="treeContainer"></div>

  <script>
    // --- Data & Rel Types ---
    let idCounter = 0;
    function genId(){ return 'n_'+(++idCounter); }

    const relTypes = [
      { key:'parent',  label:'Parent'  },
      { key:'sibling', label:'Sibling' },
      { key:'partner', label:'Partner' },
      { key:'affair',  label:'Affair'  },
      { key:'child',   label:'Child'   }
    ];

    // Root data
    const treeData = { id:genId(), name:'Main OC', age:'', gender:'', dob:'', dod:'',
                       parents:[], siblings:[], partners:[], affairs:[], children:[], notes:'' };

    // --- Toolbar: Add custom rel type ---
    document.getElementById('addRelTypeBtn').onclick = () => {
      const label = prompt('Enter new relationship label (e.g. â€œGodparentâ€):');
      if (label) {
        const key = label.toLowerCase().replace(/\s+/g,'');
        relTypes.splice(relTypes.length-1, 0, { key, label });
        render();
      }
    };

    // --- Render logic ---
    function render() {
      const c = document.getElementById('treeContainer');
      c.innerHTML = '';
      c.appendChild(makeNode(treeData));
    }

    function makeNode(d) {
      const wrap = document.createElement('div');
      wrap.className = 'tree';

      // Parents
      if (d.parents.length) {
        const pr = document.createElement('div'); pr.className='row';
        d.parents.forEach(p=>pr.appendChild(makeNode(p)));
        wrap.appendChild(pr);
        wrap.appendChild(Object.assign(document.createElement('div'),{className:'line-vert'}));
      }

      // Center row
      const cr = document.createElement('div'); cr.className='row';

      // Siblings
      if (d.siblings.length) {
        const sibWrap = document.createElement('div'); sibWrap.className='row';
        d.siblings.forEach(s=>sibWrap.appendChild(makeNode(s)));
        cr.appendChild(sibWrap);
        cr.appendChild(Object.assign(document.createElement('div'),{className:'line-horiz'}));
      }

      // Person node
      const nd = document.createElement('div'); nd.className='node';
      // Fields
      const f = document.createElement('div'); f.className='fields';
      // name & age & gender & dates & notes
      const inpName = Object.assign(document.createElement('input'),{ placeholder:'Name', value:d.name });
      inpName.onblur = ()=>d.name = inpName.value;
      const inpAge = Object.assign(document.createElement('input'),{ placeholder:'Age', value:d.age });
      inpAge.onblur = ()=>d.age = inpAge.value;
      const selGen = document.createElement('select');
      ['','male','female'].forEach(v=> {
        const o = document.createElement('option'); o.value=v; o.textContent=v||'Gender';
        if (d.gender===v) o.selected = true;
        selGen.appendChild(o);
      });
      selGen.onchange = ()=>d.gender = selGen.value;
      const inpDOB = Object.assign(document.createElement('input'),{ type:'date', value:d.dob });
      inpDOB.onblur = ()=>d.dob = inpDOB.value;
      const inpDOD = Object.assign(document.createElement('input'),{ type:'date', value:d.dod });
      inpDOD.onblur = ()=>d.dod = inpDOD.value;
      const taNotes = document.createElement('textarea');
      taNotes.rows = 2; taNotes.placeholder='Notes';
      taNotes.value = d.notes;
      taNotes.onblur = ()=>d.notes = taNotes.value;

      [inpName, inpAge, selGen, inpDOB, inpDOD, taNotes].forEach(e=>f.appendChild(e));
      nd.appendChild(f);

      // Buttons for each rel type
      const btns = document.createElement('div'); btns.className='buttons';
      relTypes.forEach(rt => {
        const b = document.createElement('button');
        b.textContent = rt.label;
        b.onclick = e => {
          e.stopPropagation();
          const np = { id:genId(), name:rt.label, age:'', gender:'', dob:'', dod:'',
                       parents:[], siblings:[], partners:[], affairs:[], children:[], notes:'' };
          if (rt.key === 'child') { d.children.push(np); np.parents.push(d); }
          else if (rt.key==='parent') d.parents.push(np);
          else if (rt.key==='sibling') d.siblings.push(np);
          else if (rt.key==='partner') d.partners.push(np);
          else if (rt.key==='affair') d.affairs.push(np);
          else d[rt.key+'s'] = d[rt.key+'s']||[], d[rt.key+'s'].push(np);
          render();
        };
        btns.appendChild(b);
      });
      // Delete
      const del = document.createElement('button');
      del.textContent = 'Delete';
      del.onclick = e => { e.stopPropagation(); deleteNode(treeData, d.id); render(); };
      btns.appendChild(del);

      nd.appendChild(btns);
      cr.appendChild(nd);

      // Partners & affairs
      if (d.partners.length) {
        cr.appendChild(Object.assign(document.createElement('div'),{className:'line-horiz'}));
        d.partners.forEach(p=>cr.appendChild(makeNode(p)));
      }
      if (d.affairs.length) {
        cr.appendChild(Object.assign(document.createElement('div'),{className:'line-horiz', style:'background:#c00'}));
        d.affairs.forEach(a=>cr.appendChild(makeNode(a)));
      }

      wrap.appendChild(cr);

      // Children
      if (d.children.length) {
        wrap.appendChild(Object.assign(document.createElement('div'),{className:'line-vert'}));
        const chRow = document.createElement('div'); chRow.className='row';
        d.children.forEach(c => chRow.appendChild(makeNode(c)));
        wrap.appendChild(chRow);
      }

      return wrap;
    }

    // Recursive delete
    function deleteNode(parent, id) {
      ['parents','siblings','partners','affairs','children'].forEach(rel=>{
        parent[rel] = parent[rel].filter(c=>{
          if (c.id===id) return false;
          deleteNode(c, id);
          return true;
        });
      });
    }

    // Initial render
    render();
  </script>
</body>
</html>
