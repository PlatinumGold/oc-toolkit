<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree Builder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <style>
    body { margin:0; font-family: Arial, sans-serif; display: flex; height:100vh; }
    #mynetwork { flex:1; background:#f0f0f0; }
    #sidebar { width:300px; background:#fff; border-left:1px solid #ccc; padding:15px; box-sizing:border-box; overflow:auto; }
    #sidebar.hidden { display:none; }
    #sidebar label { margin:8px 0 4px; display:block; font-size:.9em; }
    #sidebar input, #sidebar select, #sidebar button { width:100%; padding:6px; margin-bottom:8px; box-sizing:border-box; }
    #sidebar .rel-btns { display:flex; justify-content:space-between; }
    #sidebar .rel-btns button { width:32%; }
    #sidebar button.delete { background:#e33; color:#fff; }
  </style>
</head>
<body>
  <div id="mynetwork"></div>
  <div id="sidebar" class="hidden">
    <h2>Edit Character</h2>
    <label>Name</label><input id="charName" type="text" />
    <label>Gender</label>
    <select id="charGender">
      <option value="">Unknown</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
    <label>DOB</label><input id="charDOB" type="date" />
    <label>DOD</label><input id="charDOD" type="date" />
    <div class="rel-btns">
      <button id="addParent">+ Parent</button>
      <button id="addChild">+ Child</button>
      <button id="addPartner">+ Partner</button>
    </div>
    <button id="saveDetails">Save Details</button>
    <button id="deleteNode" class="delete">Delete</button>
  </div>

  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script>
    // --- DataSets ---
    const nodes = new vis.DataSet();
    const edges = new vis.DataSet();

    // --- Network with hierarchical layout ---
    const container = document.getElementById('mynetwork');
    const data = { nodes, edges };
    const options = {
      nodes: { shape: 'box', margin:10 },
      edges: {
        arrows: { to:{ enabled:true, type:'arrow' } },
        smooth: { enabled:true, type:'vertical' }
      },
      layout: {
        hierarchical: {
          enabled: true,
          direction: 'UD',           // Up â†’ Down
          nodeSpacing: 200,
          levelSeparation: 150,
          treeSpacing: 200
        }
      },
      physics: { enabled:false },
      interaction: { dragNodes:true, dragView:true, zoomView:true }
    };
    const network = new vis.Network(container, data, options);

    // --- Sidebar refs ---
    const sidebar    = document.getElementById('sidebar');
    const inpName    = document.getElementById('charName');
    const inpGender  = document.getElementById('charGender');
    const inpDOB     = document.getElementById('charDOB');
    const inpDOD     = document.getElementById('charDOD');
    const btnParent  = document.getElementById('addParent');
    const btnChild   = document.getElementById('addChild');
    const btnPartner = document.getElementById('addPartner');
    const btnSave    = document.getElementById('saveDetails');
    const btnDelete  = document.getElementById('deleteNode');

    let selectedNodeId = null;
    const nextId = ()=> nodes.length + 1;

    // --- Create main character on load ---
    window.addEventListener('load', () => {
      nodes.add({ id:1, label:'Main Character', gender:'', dob:'', dod:'', color:'#ccc' });
    });

    // --- Toggle sidebar on select/deselect ---
    network.on('selectNode', ({ nodes:[id] })=> {
      selectedNodeId = id;
      const d = nodes.get(id);
      inpName.value   = d.label.split('\n')[0];
      inpGender.value = d.gender;
      inpDOB.value    = d.dob;
      inpDOD.value    = d.dod;
      sidebar.classList.remove('hidden');
    });
    network.on('deselectNode', ()=>{
      selectedNodeId = null;
      sidebar.classList.add('hidden');
    });

    // --- Save edits back to node ---
    btnSave.onclick = () => {
      if (!selectedNodeId) return;
      const upd = { id:selectedNodeId };
      upd.label  = inpName.value;
      upd.gender = inpGender.value;
      upd.dob    = inpDOB.value;
      upd.dod    = inpDOD.value;
      // color-code by gender
      if (upd.gender==='male')    upd.color='#8fbfe0';
      else if (upd.gender==='female') upd.color='#e08fbf';
      else upd.color='#ccc';
      // append dates on new line
      let extra = [];
      if (upd.dob) extra.push('b. '+upd.dob);
      if (upd.dod) extra.push('d. '+upd.dod);
      if (extra.length) upd.label += '\n'+extra.join(', ');
      nodes.update(upd);
    };

    // --- Delete node & its edges ---
    btnDelete.onclick = () => {
      if (selectedNodeId) {
        nodes.remove(selectedNodeId);
        selectedNodeId = null;
        sidebar.classList.add('hidden');
      }
    };

    // --- Add Parent (one per invocation) ---
    btnParent.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const pid = nextId();
      nodes.add({ id:pid, label:'New Parent', gender:'', dob:'', dod:'', color:'#ccc' });
      edges.add({ from:pid, to:selectedNodeId, label:'parent', color:{color:'#555'} });
      network.selectNodes([pid]);
    };

    // --- Add Child ---
    btnChild.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const cid = nextId();
      nodes.add({ id:cid, label:'New Child', gender:'', dob:'', dod:'', color:'#ccc' });
      edges.add({ from:selectedNodeId, to:cid, label:'parent', color:{color:'#555'} });
      network.selectNodes([cid]);
    };

    // --- Add Partner (dashed curve) ---
    btnPartner.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const qid = nextId();
      nodes.add({ id:qid, label:'New Partner', gender:'', dob:'', dod:'', color:'#ccc' });
      edges.add({ from:selectedNodeId, to:qid,   label:'partner', dashes:true, color:{color:'#c53'} });
      edges.add({ from:qid,             to:selectedNodeId, label:'partner', dashes:true, color:{color:'#c53'} });
      network.selectNodes([qid]);
    };
  </script>
</body>
</html>
