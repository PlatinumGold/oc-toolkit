<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree Builder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: Arial, sans-serif;
    }
    #mynetwork {
      flex: 1;
      background: #eef2f5;
      position: relative;
    }
    #sidebar {
      width: 300px;
      background: #fff;
      border-left: 1px solid #ccc;
      padding: 15px;
      box-sizing: border-box;
      overflow: auto;
    }
    #sidebar.hidden { display: none; }
    #sidebar h2 { margin-top: 0; }
    #sidebar label { margin: 8px 0 4px; display: block; font-size: .9em; }
    #sidebar input,
    #sidebar select,
    #sidebar button {
      width: 100%;
      padding: 6px;
      margin-bottom: 8px;
      box-sizing: border-box;
    }
    #sidebar .rel-btns {
      display: flex;
      justify-content: space-between;
    }
    #sidebar .rel-btns button {
      width: 32%;
    }
    #sidebar button.delete {
      background: #e33;
      color: #fff;
    }
    /* Header bar */
    #header {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #444;
      color: #fff;
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: bold;
      z-index: 1;
    }
  </style>
</head>
<body>

  <div id="mynetwork">
    <div id="header">Family Tree Builder</div>
  </div>

  <div id="sidebar" class="hidden">
    <h2>Edit Character</h2>
    <label>Name</label><input id="charName" type="text"/>
    <label>Gender</label>
    <select id="charGender">
      <option value="">Unknown</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
    <label>DOB</label><input id="charDOB" type="date"/>
    <label>DOD</label><input id="charDOD" type="date"/>
    <div class="rel-btns">
      <button id="addParent">+ Parent</button>
      <button id="addChild">+ Child</button>
      <button id="addSibling">+ Sibling</button>
      <button id="addPartner">+ Partner</button>
    </div>
    <button id="saveDetails">Save Details</button>
    <button id="deleteNode" class="delete">Delete</button>
  </div>

  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script>
    const nodes = new vis.DataSet();
    const edges = new vis.DataSet();

    // Initialize network with hierarchical layout (parents above children)
    const network = new vis.Network(
      document.getElementById('mynetwork'),
      { nodes, edges },
      {
        layout: {
          hierarchical: {
            enabled: true,
            direction: 'UD',
            levelSeparation: 150,
            nodeSpacing: 200,
            treeSpacing: 200
          }
        },
        physics: { enabled: false },
        interaction: { dragNodes: true, dragView: true, zoomView: true },
        nodes: { shape: 'box', margin: 10 },
        edges: {
          arrows: { to: { enabled: true, type: 'arrow' } },
          smooth: { enabled: true, type: 'straightVertical' }
        }
      }
    );

    // Sidebar elements
    const sidebar    = document.getElementById('sidebar');
    const inpName    = document.getElementById('charName');
    const inpGender  = document.getElementById('charGender');
    const inpDOB     = document.getElementById('charDOB');
    const inpDOD     = document.getElementById('charDOD');
    const btnParent  = document.getElementById('addParent');
    const btnChild   = document.getElementById('addChild');
    const btnSibling = document.getElementById('addSibling');
    const btnPartner = document.getElementById('addPartner');
    const btnSave    = document.getElementById('saveDetails');
    const btnDelete  = document.getElementById('deleteNode');

    let selectedNodeId = null;
    const nextId = () => nodes.length + 1;

    // Create main node on load
    window.addEventListener('load', () => {
      nodes.add({
        id: 1,
        label: 'Main OC',
        gender: '',
        dob: '',
        dod: '',
        color: '#ccc'
      });
    });

    // Show sidebar when a node is selected
    network.on('selectNode', ({ nodes: [id] }) => {
      selectedNodeId = id;
      const data = nodes.get(id);
      inpName.value   = data.label.split('\n')[0];
      inpGender.value = data.gender;
      inpDOB.value    = data.dob;
      inpDOD.value    = data.dod;
      sidebar.classList.remove('hidden');
    });
    network.on('deselectNode', () => {
      selectedNodeId = null;
      sidebar.classList.add('hidden');
    });

    // Save edits
    btnSave.onclick = () => {
      if (!selectedNodeId) return;
      const upd = { id: selectedNodeId };
      upd.label  = inpName.value;
      upd.gender = inpGender.value;
      upd.dob    = inpDOB.value;
      upd.dod    = inpDOD.value;
      // color by gender
      if      (inpGender.value === 'male')   upd.color = '#8fbfe0';
      else if (inpGender.value === 'female') upd.color = '#e08fbf';
      else upd.color = '#ccc';
      // append dates
      let extras = [];
      if (inpDOB.value) extras.push('b. ' + inpDOB.value);
      if (inpDOD.value) extras.push('d. ' + inpDOD.value);
      if (extras.length) upd.label += '\n' + extras.join(', ');
      nodes.update(upd);
    };

    // Delete node and its edges
    btnDelete.onclick = () => {
      if (selectedNodeId) {
        nodes.remove(selectedNodeId);
        selectedNodeId = null;
        sidebar.classList.add('hidden');
      }
    };

    // Add Parent
    btnParent.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const pid = nextId();
      nodes.add({ id: pid, label: 'New Parent', color: '#ccc', gender: '', dob: '', dod: '' });
      edges.add({ from: pid, to: selectedNodeId });
      network.selectNodes([pid]);
    };

    // Add Child
    btnChild.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const cid = nextId();
      nodes.add({ id: cid, label: 'New Child', color: '#ccc', gender: '', dob: '', dod: '' });
      edges.add({ from: selectedNodeId, to: cid });
      network.selectNodes([cid]);
    };

    // Add Sibling
    btnSibling.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      // need at least one parent to create siblings
      const parentEdges = edges.get({ filter: e => e.to === selectedNodeId });
      if (parentEdges.length === 0) {
        return alert('Add a parent firstâ€”siblings are other children of the same parent.');
      }
      const sid = nextId();
      nodes.add({ id: sid, label: 'New Sibling', color: '#ccc', gender: '', dob: '', dod: '' });
      // attach to same parents
      parentEdges.forEach(e => {
        edges.add({ from: e.from, to: sid });
      });
      network.selectNodes([sid]);
    };

    // Add Partner (dashed curve)
    btnPartner.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const qid = nextId();
      nodes.add({ id: qid, label: 'New Partner', color: '#ccc', gender: '', dob: '', dod: '' });
      edges.add({ 
        from: selectedNodeId, to: qid,
        dashes: true,
        color: { color: '#c53' },
        smooth: { enabled: true, type: 'curvedCW', roundness: 0.2 }
      });
      edges.add({ 
        from: qid, to: selectedNodeId,
        dashes: true,
        color: { color: '#c53' },
        smooth: { enabled: true, type: 'curvedCW', roundness: 0.2 }
      });
      network.selectNodes([qid]);
    };
  </script>
</body>
</html>
