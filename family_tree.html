<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OC Family Tree</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1, p { text-align: center; color: #333; }
    .tree { display: flex; flex-direction: column; align-items: center; }
    .row { display: flex; justify-content: center; margin: 20px 0; }
    .node {
      background: #fff; border: 2px solid #333; padding: 10px; margin: 10px;
      min-width: 120px; text-align: center; border-radius: 8px; position: relative;
    }
    .node .fields { margin-bottom: 8px; }
    .node .fields input,
    .node .fields select {
      width: 90%; margin: 2px 0; padding: 4px; font-size: 0.9em;
    }
    .buttons { margin-top: 8px; }
    .buttons button {
      margin: 2px; padding: 4px 6px; font-size: 0.8em; cursor: pointer;
    }
    .line-vert {
      height: 20px; width: 2px; background: #000; margin: auto;
    }
  </style>
</head>
<body>
  <h1>OC Family Tree</h1>
  <p>Use the buttons below each person to add or remove relations. Edit fields inline.</p>
  <div id="treeContainer" class="tree"></div>

  <script>
    let idCounter = 0;
    function genId() { return 'n_' + idCounter++; }

    // Initial data
    const treeData = {
      id: genId(), name: 'Main OC', age: '', gender: '', dob: '', dod: '',
      parents: [], siblings: [], partners: [], affairs: [], children: []
    };

    // Render entire tree
    function render() {
      const cont = document.getElementById('treeContainer');
      cont.innerHTML = '';
      cont.appendChild(makeNode(treeData));
    }

    // Recursive builder
    function makeNode(d) {
      const wrap = document.createElement('div');
      wrap.className = 'tree';

      // Parents
      if (d.parents.length) {
        const pr = document.createElement('div'); pr.className='row';
        d.parents.forEach(p=>pr.appendChild(makeNode(p)));
        wrap.appendChild(pr);
        wrap.appendChild(Object.assign(document.createElement('div'),{className:'line-vert'}));
      }

      // Center row: siblings, this node, partners, affairs
      const cr = document.createElement('div'); cr.className='row';
      d.siblings.forEach(s=>cr.appendChild(makeNode(s)));

      // This person
      const nd = document.createElement('div'); nd.className='node';

      // Fields: name, age, gender, dob, dod
      const f = document.createElement('div'); f.className='fields';
      // name
      const inName = Object.assign(document.createElement('input'), {
        value: d.name, placeholder:'Name'
      });
      inName.onblur = ()=>d.name=inName.value;
      // age
      const inAge = Object.assign(document.createElement('input'), {
        value: d.age, placeholder:'Age'
      });
      inAge.onblur = ()=>d.age=inAge.value;
      // gender
      const inGen = document.createElement('select');
      ['','male','female'].forEach(v=>{
        const o=document.createElement('option'); o.value=v; o.textContent=v||'Gender';
        if(v===d.gender) o.selected=true;
        inGen.appendChild(o);
      });
      inGen.onchange = ()=>d.gender=inGen.value;
      // dob/dod
      const inDOB = Object.assign(document.createElement('input'), {
        type:'date', value:d.dob
      }); inDOB.onblur = ()=>d.dob=inDOB.value;
      const inDOD = Object.assign(document.createElement('input'), {
        type:'date', value:d.dod
      }); inDOD.onblur = ()=>d.dod=inDOD.value;

      [inName,inAge,inGen,inDOB,inDOD].forEach(x=>f.appendChild(x));
      nd.appendChild(f);

      // Buttons
      const btns = document.createElement('div'); btns.className='buttons';
      [['Parent','parent'],['Sibling','sibling'],['Partner','partner'],
       ['Affair','affair'],['Child','child'],['Delete','delete']]
      .forEach(([label,type])=>{
        const b=document.createElement('button');
        b.textContent=label;
        b.onclick=e=>{
          e.stopPropagation();
          if(type==='delete') return deleteNode(treeData, d.id), render();
          addRel(d,type);
          render();
        };
        btns.appendChild(b);
      });
      nd.appendChild(btns);
      cr.appendChild(nd);

      d.partners.forEach(p=>cr.appendChild(makeNode(p)));
      d.affairs.forEach(a=>cr.appendChild(makeNode(a)));

      wrap.appendChild(cr);

      // Children
      if (d.children.length) {
        wrap.appendChild(Object.assign(document.createElement('div'),{className:'line-vert'}));
        const cr2 = document.createElement('div'); cr2.className='row';
        d.children.forEach(c=> cr2.appendChild(makeNode(c)));
        wrap.appendChild(cr2);
      }

      return wrap;
    }

    // Add relationship
    function addRel(node,type) {
      const np = { id:genId(), name:type, age:'', gender:'', dob:'', dod:'',
                   parents:[], siblings:[], partners:[], affairs:[], children:[] };
      node[type+'s'].push(np);
      // If adding a child, also link as parent:
      if(type==='child') np.parents.push(node);
    }

    // Delete a node by id from the structure
    function deleteNode(parent, id) {
      ['parents','siblings','partners','affairs','children'].forEach(rel=>{
        parent[rel] = parent[rel].filter(c=>{
          if(c.id===id) return false;
          // recurse into children
          deleteNode(c, id);
          return true;
        });
      });
    }

    // Initial render
    render();
  </script>
</body>
</html>
