<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Family Tree Builder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <style>
    body { margin:0; font-family: Arial, sans-serif; display: flex; height:100vh; }
    #mynetwork { flex:1; background:#f0f0f0; }
    #sidebar { width: 300px; background:#fff; border-left:1px solid #ccc; padding:15px; box-sizing:border-box; display: flex; flex-direction: column; }
    #sidebar.hidden { display: none; }
    #sidebar h2 { margin-top:0; }
    #sidebar label { margin: 8px 0 4px; display:block; font-size:0.9em; }
    #sidebar input, #sidebar select, #sidebar button {
      width:100%; padding:6px; margin-bottom:8px; box-sizing:border-box;
    }
    #sidebar .rel-btns { display:flex; justify-content:space-between; }
    #sidebar .rel-btns button { width:32%; }
    #sidebar button.delete { background:#e33; color:#fff; }
  </style>
</head>
<body>
  <div id="mynetwork"></div>
  <div id="sidebar" class="hidden">
    <h2>Edit Character</h2>
    <label>Name</label><input id="charName" type="text" />
    <label>Gender</label>
    <select id="charGender">
      <option value="">Unknown</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
    <label>Date of Birth</label><input id="charDOB" type="date" />
    <label>Date of Death</label><input id="charDOD" type="date" />
    <div class="rel-btns">
      <button id="addParent">+ Parent</button>
      <button id="addSibling">+ Sibling</button>
      <button id="addPartner">+ Partner</button>
    </div>
    <button id="saveDetails">Save Details</button>
    <button id="deleteNode" class="delete">Delete</button>
  </div>

  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script>
    const nodes = new vis.DataSet();
    const edges = new vis.DataSet();
    const container = document.getElementById('mynetwork');
    const network = new vis.Network(container, { nodes, edges }, {
      interaction:{ dragNodes:true, dragView:true },
      manipulation: { enabled: false },
      edges:{ smooth:false, arrows:{ to:true } },
      physics:{ enabled:true },
      layout:{ improvedLayout:false }
    });

    // Sidebar refs
    const sidebar    = document.getElementById('sidebar');
    const inpName    = document.getElementById('charName');
    const inpGender  = document.getElementById('charGender');
    const inpDOB     = document.getElementById('charDOB');
    const inpDOD     = document.getElementById('charDOD');
    const btnParent  = document.getElementById('addParent');
    const btnSibling = document.getElementById('addSibling');
    const btnPartner = document.getElementById('addPartner');
    const btnSave    = document.getElementById('saveDetails');
    const btnDelete  = document.getElementById('deleteNode');

    let selectedNodeId = null;

    function nextId() {
      return nodes.length + 1;
    }

    // Add main character on load
    window.addEventListener('load', () => {
      nodes.add({ id: 1, label:'Main Character', color:'#ccc', physics:false });
    });

    // Show sidebar on select
    network.on('selectNode', params => {
      selectedNodeId = params.nodes[0];
      const data = nodes.get(selectedNodeId);
      inpName.value   = data.label.split('\\n')[0];
      inpGender.value = data.gender || '';
      inpDOB.value    = data.dob || '';
      inpDOD.value    = data.dod || '';
      sidebar.classList.remove('hidden');
    });
    network.on('deselectNode', () => {
      selectedNodeId = null;
      sidebar.classList.add('hidden');
    });

    // Save details
    btnSave.onclick = () => {
      if (!selectedNodeId) return;
      const update = { id:selectedNodeId };
      update.label = inpName.value;
      update.gender = inpGender.value;
      update.dob    = inpDOB.value;
      update.dod    = inpDOD.value;
      // color by gender
      if (update.gender==='male')   update.color = '#8fbfe0';
      else if (update.gender==='female') update.color = '#e08fbf';
      else update.color = '#ccc';
      // append dates on new line
      const dates = [];
      if (update.dob) dates.push('b. '+update.dob);
      if (update.dod) dates.push('d. '+update.dod);
      if (dates.length) update.label += '\\n'+dates.join(', ');
      nodes.update(update);
    };

    // Delete node
    btnDelete.onclick = () => {
      if (selectedNodeId) {
        nodes.remove(selectedNodeId);
        sidebar.classList.add('hidden');
      }
    };

    // Relationship adders
    function getPos(id){ return network.getPositions([id])[id]; }

    btnParent.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const parentId = nextId();
      const pos = getPos(selectedNodeId);
      nodes.add({
        id: parentId,
        label: 'New Parent',
        color: '#ccc',
        x: pos.x,
        y: pos.y - 200,
        fixed: { x:true, y:true },
        physics: false
      });
      edges.add({ from: parentId, to: selectedNodeId, label:'parent', color:{color:'#555'} });
      network.selectNodes([parentId]);
    };

    btnSibling.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const sibId = nextId();
      const pos = getPos(selectedNodeId);
      nodes.add({
        id: sibId,
        label: 'New Sibling',
        color:'#ccc',
        x: pos.x - 200,
        y: pos.y,
        fixed:{ x:true, y:true },
        physics: false
      });
      // copy all parent edges
      edges.get().filter(e=> e.to===selectedNodeId && e.label==='parent')
                  .forEach(e=> edges.add({ from:e.from, to: sibId, label:'parent', color:{color:'#555'} }));
      network.selectNodes([sibId]);
    };

    btnPartner.onclick = () => {
      if (!selectedNodeId) return alert('Select a character first');
      const pId = nextId();
      const pos = getPos(selectedNodeId);
      nodes.add({
        id: pId,
        label: 'New Partner',
        color:'#ccc',
        x: pos.x + 200,
        y: pos.y,
        fixed:{ x:true, y:true },
        physics: false
      });
      // bidirectional partner edges
      edges.add({ from: selectedNodeId, to: pId,   label:'partner', dashes:true, color:{color:'#c53'} });
      edges.add({ from: pId,             to: selectedNodeId, label:'partner', dashes:true, color:{color:'#c53'} });
      network.selectNodes([pId]);
    };
  </script>
</body>
</html>
