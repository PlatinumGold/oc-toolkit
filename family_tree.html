<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OC Family Tree Builder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <style>
    body { margin:0; font-family: Arial, sans-serif; display: flex; height:100vh; }
    #network { flex:1; background:#f5f7fa; }
    #sidebar {
      width:260px; background:#fff; border-left:1px solid #ccc;
      box-shadow:-2px 0 8px rgba(0,0,0,0.1); padding:15px; overflow:auto;
    }
    #sidebar.hidden { display:none; }
    #sidebar h2 { margin-top:0; font-size:1.1em; color:#334e68; }
    #sidebar label { display:block; margin:8px 0 4px; font-size:.9em; }
    #sidebar input, #sidebar select, #sidebar button {
      width:100%; padding:6px; margin-bottom:8px; box-sizing:border-box;
      border:1px solid #ccc; border-radius:4px;
    }
    #sidebar button {
      background:#334e68; color:#fff; border:none; cursor:pointer;
    }
    #sidebar button:hover { background:#4a6fa5; }
    #sidebar button.delete { background:#c53; }
    #header {
      position:absolute; top:0; left:0; right:0; background:#334e68;
      color:#fff; text-align:center; padding:10px; font-weight:bold; z-index:1;
    }
  </style>
</head>
<body>

  <div id="network">
    <div id="header">üß¨ OC Family Tree Builder</div>
  </div>

  <div id="sidebar" class="hidden">
    <h2>Edit ‚Äú<span id="nodeNamePreview"></span>‚Äù</h2>
    <label>Name</label>
    <input id="nodeName" placeholder="Name‚Ä¶" />
    <label>Gender</label>
    <select id="nodeGender">
      <option value="">Unknown</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
    <label>DOB</label>
    <input id="nodeDOB" type="date" />
    <label>DOD</label>
    <input id="nodeDOD" type="date" />

    <button id="btnParent">+ Parent</button>
    <button id="btnChild">+ Child</button>
    <button id="btnSibling">+ Sibling</button>
    <button id="btnPartner">‚ò∞ Partner</button>
    <button id="btnAffair">‚ù§ Affair</button>

    <button id="btnSave">Save</button>
    <button id="btnDelete" class="delete">Delete</button>
  </div>

  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script>
    // --- Setup ---
    const container = document.getElementById('network');
    const nodes = new vis.DataSet();
    const edges = new vis.DataSet();
    let selectedId = null;

    // Create the network with hierarchical layout
    const network = new vis.Network(container, { nodes, edges }, {
      layout: { hierarchical: {
        enabled:true, direction:'UD', levelSeparation:150, nodeSpacing:200, sortMethod:'directed'
      }},
      physics: { enabled:false },
      interaction: { dragNodes:true, dragView:true, zoomView:true },
      nodes: { shape:'box', margin:10, color:{border:'#334e68', background:'#fff'} },
      edges: {
        smooth:{ enabled:true, type:'curvedCCW', roundness:0.2 },
        arrows:{ to:{enabled:true,type:'arrow'} }
      }
    });

    // Sidebar elements
    const sidebar = document.getElementById('sidebar');
    const nameIn = document.getElementById('nodeName');
    const genderIn = document.getElementById('nodeGender');
    const dobIn = document.getElementById('nodeDOB');
    const dodIn = document.getElementById('nodeDOD');
    const preview = document.getElementById('nodeNamePreview');
    const btnSave = document.getElementById('btnSave');
    const btnDelete = document.getElementById('btnDelete');
    const btnParent = document.getElementById('btnParent');
    const btnChild = document.getElementById('btnChild');
    const btnSibling = document.getElementById('btnSibling');
    const btnPartner = document.getElementById('btnPartner');
    const btnAffair = document.getElementById('btnAffair');

    // Helper for new IDs
    let idCount = 0;
    function newId() { return ++idCount; }

    // Add Main OC
    nodes.add({
      id: newId(),
      label: 'Main OC',
      gender:'', dob:'', dod:''
    });

    // Handle selection
    network.on('selectNode', params => {
      selectedId = params.nodes[0];
      const data = nodes.get(selectedId);
      // populate sidebar
      preview.textContent = data.label.split('\\n')[0];
      nameIn.value = data.label.split('\\n')[0];
      genderIn.value = data.gender;
      dobIn.value = data.dob;
      dodIn.value = data.dod;
      sidebar.classList.remove('hidden');
    });
    network.on('deselectNode', () => {
      selectedId = null;
      sidebar.classList.add('hidden');
    });

    // Save edits
    btnSave.onclick = () => {
      if (!selectedId) return;
      const update = { id: selectedId };
      const base = nameIn.value || 'Unnamed';
      let label = base;
      const extras = [];
      if (dobIn.value) extras.push('b.'+dobIn.value);
      if (dodIn.value) extras.push('d.'+dodIn.value);
      if (extras.length) label += '\\n'+extras.join(', ');
      update.label = label;
      update.gender = genderIn.value;
      update.dob = dobIn.value;
      update.dod = dodIn.value;
      // color by gender
      if (genderIn.value === 'male') update.color = {border:'#4b8bbe',background:'#eef4fc'};
      else if (genderIn.value === 'female') update.color = {border:'#d15fa8',background:'#fceef4'};
      else update.color = {border:'#334e68',background:'#fff'};
      nodes.update(update);
      preview.textContent = base;
    };

    // Delete node
    btnDelete.onclick = () => {
      if (selectedId) {
        nodes.remove({id:selectedId});
        selectedId = null;
        sidebar.classList.add('hidden');
      }
    };

    // Relationship helpers
    function addEdge(from, to, opts={}){
      edges.add(Object.assign({ from, to }, opts));
    }

    // Add Parent
    btnParent.onclick = () => {
      if (!selectedId) return alert('Select someone first!');
      const pid = newId();
      nodes.add({ id: pid, label:'Parent', gender:'', dob:'', dod:'' });
      addEdge(pid, selectedId);                    // parent ‚Üí child
      network.selectNodes([pid]);
    };

    // Add Child
    btnChild.onclick = () => {
      if (!selectedId) return alert('Select someone first!');
      const cid = newId();
      nodes.add({ id: cid, label:'Child', gender:'', dob:'', dod:'' });
      addEdge(selectedId, cid);                    // parent ‚Üí child
      network.selectNodes([cid]);
    };

    // Add Sibling (share all parents)
    btnSibling.onclick = () => {
      if (!selectedId) return alert('Select someone first!');
      // find parents of selected
      const parentEdges = edges.get({ filter: e => e.to===selectedId });
      if (parentEdges.length === 0) return alert('No parents to share!');
      const sid = newId();
      nodes.add({ id: sid, label:'Sibling', gender:'', dob:'', dod:'' });
      parentEdges.forEach(e => addEdge(e.from, sid));
      network.selectNodes([sid]);
    };

    // Add Partner (solid curve)
    btnPartner.onclick = () => {
      if (!selectedId) return alert('Select someone first!');
      const pid = newId();
      nodes.add({ id: pid, label:'Partner', gender:'', dob:'', dod:'' });
      addEdge(selectedId, pid, { smooth:{type:'curvedCW', roundness:0.4} });
      addEdge(pid, selectedId, { smooth:{type:'curvedCW', roundness:0.4} });
      network.selectNodes([pid]);
    };

    // Add Affair (dashed red curve)
    btnAffair.onclick = () => {
      if (!selectedId) return alert('Select someone first!');
      const aid = newId();
      nodes.add({ id: aid, label:'Affair', gender:'', dob:'', dod:'' });
      addEdge(selectedId, aid, {
        dashes:true,
        color:{color:'#c00'},
        smooth:{type:'curvedCCW', roundness:0.4}
      });
      addEdge(aid, selectedId, {
        dashes:true,
        color:{color:'#c00'},
        smooth:{type:'curvedCCW', roundness:0.4}
      });
      network.selectNodes([aid]);
    };
  </script>
</body>
</html>
