<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crime Sentence Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { font-family: Arial, sans-serif; margin:0; }
    header { background:#c0392b; color:white; padding:16px; text-align:center; font-size:1.5em; }
    main { max-width:700px; margin:20px auto; padding:0 16px; }
    label { display:block; margin-top:12px; }
    select, input[type="number"], input[type="text"] {
      width:100%; padding:8px; box-sizing:border-box; margin-top:4px;
    }
    .inline { display:inline-block; width:48%; vertical-align:top; }
    .inline + .inline { margin-left:4%; }
    #subtype, #otherText { margin-top:4px; }
    #saModal {
      display:none; position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.6); align-items:center; justify-content:center;
    }
    #saModal .modal {
      background:white; padding:20px; border-radius:6px; max-width:400px; text-align:center;
    }
    button, input[type="button"] {
      margin-top:16px; padding:10px 20px;
      background:#c0392b; color:white; border:none; cursor:pointer;
      font-size:1em;
    }
    #stack { margin-top:20px; }
    #stack table {
      width:100%; border-collapse:collapse; margin-top:8px;
    }
    #stack th, #stack td {
      border:1px solid #ccc; padding:6px; text-align:left;
    }
    #stack td small { display:block; color:#666; margin-top:4px; }
    #results { margin-top:20px; padding:12px; background:#eef; border-radius:4px; }
    #persistMsg { font-size:.9em; color:#666; margin-top:8px; }
  </style>
</head>
<body>

<header>⚖️ Crime Sentence Calculator</header>
<main>

  <label>Crime Category
    <select id="category">
      <option value="">— Select —</option>
      <option value="murder">Murder</option>
      <option value="sa">Sexual Assault (SA)</option>
      <option value="stealing">Stealing</option>
      <option value="trafficking">Trafficking</option>
      <option value="piracy">Piracy</option>
      <option value="arson">Arson</option>
      <option value="fraud">Fraud</option>
      <option value="genocide">Genocide</option>
      <option value="torture">Torture</option>
      <option value="other">Other</option>
    </select>
  </label>

  <!-- Trigger warning modal -->
  <div id="saModal">
    <div class="modal">
      <p><strong>Trigger Warning:</strong><br>
      This category includes graphic sexual violence.</p>
      <button id="saOk">I Understand</button>
    </div>
  </div>

  <label>Crime Subtype</label>
  <select id="subtype" disabled></select>
  <input id="otherText" type="text" placeholder="Enter custom crime" style="display:none;"/>

  <label>Country (affects sentencing)</label>
  <select id="country">
    <option value="">Default (World Avg)</option>
    <option value="usa">USA</option>
    <option value="uk">UK</option>
    <option value="canada">Canada</option>
    <option value="australia">Australia</option>
    <option value="germany">Germany</option>
    <option value="france">France</option>
  </select>

  <div id="customOverrides">
    <p><em>Override defaults (optional):</em></p>
    <div class="inline">
      <label>Min Years<input id="minYears" type="number" min="0"/></label>
    </div>
    <div class="inline">
      <label>Max Years<input id="maxYears" type="number" min="0"/></label>
    </div>
    <label><input id="capitalPun" type="checkbox"/> Capital Punishment?</label>
  </div>

  <div>
    <label>Quantity (# of times committed)
      <input id="qty" type="number" min="1" value="1"/>
    </label>
  </div>

  <button id="addCrime">➕ Add Crime to Stack</button>

  <div id="stack">
    <h3>Crime Stack</h3>
    <table>
      <thead>
        <tr>
          <th>Crime</th><th>Qty</th>
          <th>Range</th><th>Capital</th><th>Definition</th><th>Remove</th>
        </tr>
      </thead>
      <tbody id="stackBody"></tbody>
    </table>
    <label>
      <input type="radio" name="mode" value="concurrent" checked/> Concurrent
    </label>
    <label>
      <input type="radio" name="mode" value="consecutive"/> Consecutive
    </label>
  </div>

  <button id="calculate">Calculate Sentence</button>
  <div id="results"></div>
  <div id="persistMsg">Your stack and settings are saved automatically.</div>
</main>

<script>
  // — Data definitions — 
  const categories = {
    murder:     ['first','second','voluntary','involuntary'],
    sa:         ['rape','statutory','sexualAssault'],
    stealing:   ['petty','armed','burglary','embezzlement'],
    trafficking:['human','drug'],
    piracy:     ['maritime','digital'],
    arson:      ['firstArson','secondArson'],
    fraud:      ['bank','insurance','election'],
    genocide:   ['genocide'],
    torture:    ['torture'],
    other:      []  // free-text
  };
  const subtypeLabels = {
    first:  'First-Degree Murder',
    second: 'Second-Degree Murder',
    voluntary:'Voluntary Manslaughter',
    involuntary:'Involuntary Manslaughter',
    rape:   'Rape',
    statutory:'Statutory Rape',
    sexualAssault:'Sexual Assault',
    petty:  'Petty Theft (Larceny)',
    armed:  'Armed Robbery',
    burglary:'Burglary',
    embezzlement:'Embezzlement',
    human:  'Human Trafficking',
    drug:   'Drug Trafficking',
    maritime:'Maritime Piracy',
    digital:'Digital Piracy',
    firstArson:'First-Degree Arson',
    secondArson:'Second-Degree Arson',
    bank:   'Bank Fraud',
    insurance:'Insurance Fraud',
    election:'Election Fraud',
    genocide:'Genocide',
    torture:'Torture'
  };
  const definitions = {
    'First-Degree Murder':'Intentional killing with premeditation.',
    'Second-Degree Murder':'Intentional killing without premeditation.',
    'Voluntary Manslaughter':'Heat-of-passion killing.',
    'Involuntary Manslaughter':'Unintentional killing by negligence.',
    'Rape':'Non-consensual sexual intercourse.',
    'Statutory Rape':'Sexual act with minor.',
    'Sexual Assault':'Any non-consensual sexual act.',
    'Petty Theft (Larceny)':'Stealing low-value property.',
    'Armed Robbery':'Theft using a weapon.',
    'Burglary':'Unlawful entry to commit theft.',
    'Embezzlement':'Misappropriation of funds.',
    'Human Trafficking':'Exploitation of persons.',
    'Drug Trafficking':'Distribution of illegal drugs.',
    'Maritime Piracy':'Robbery at sea.',
    'Digital Piracy':'Unauthorized copying/distribution.',
    'First-Degree Arson':'Willful burning of property.',
    'Second-Degree Arson':'Less severe arson.',
    'Bank Fraud':'Deception to obtain bank assets.',
    'Insurance Fraud':'False insurance claims.',
    'Election Fraud':'Illicit manipulation of elections.',
    'Genocide':'Intent to destroy a group.',
    'Torture':'Inflicting severe pain.'
  };
  const defaultRanges = {
    first: {min:20,max:40,cap:true},
    second:{min:15,max:30,cap:false},
    voluntary:{min:3,max:10,cap:false},
    involuntary:{min:1,max:5,cap:false},
    rape:{min:10,max:30,cap:false},
    statutory:{min:5,max:15,cap:false},
    sexualAssault:{min:8,max:25,cap:false},
    petty:{min:0,max:2,cap:false},
    armed:{min:7,max:20,cap:false},
    burglary:{min:5,max:20,cap:false},
    embezzlement:{min:1,max:10,cap:false},
    human:{min:10,max:30,cap:false},
    drug:{min:5,max:40,cap:false},
    maritime:{min:5,max:20,cap:false},
    digital:{min:0,max:2,cap:false},
    firstArson:{min:5,max:20,cap:false},
    secondArson:{min:3,max:10,cap:false},
    bank:{min:2,max:15,cap:false},
    insurance:{min:2,max:10,cap:false},
    election:{min:5,max:20,cap:false},
    genocide:{min:25,max:50,cap:false},
    torture:{min:5,max:25,cap:false}
  };
  const countryMods = {
    usa:{minMul:1.1,maxMul:1.2},
    uk:{minMul:0.9,maxMul:0.95},
    canada:{minMul:0.8,maxMul:0.9},
    australia:{minMul:0.85,maxMul:0.95},
    germany:{minMul:0.7,maxMul:0.8},
    france:{minMul:0.8,maxMul:0.9}
  };

  // — State & Persistence —
  let stack = [];
  function save(){ localStorage.crimeStack = JSON.stringify(stack); }
  function load(){
    try{ stack = JSON.parse(localStorage.crimeStack)||[]; }catch{ stack=[]; }
    renderStack();
  }

  // — UI Refs —
  const cat = document.getElementById('category'),
        sub = document.getElementById('subtype'),
        oth = document.getElementById('otherText'),
        country = document.getElementById('country'),
        minY = document.getElementById('minYears'),
        maxY = document.getElementById('maxYears'),
        cap = document.getElementById('capitalPun'),
        qty = document.getElementById('qty'),
        addB = document.getElementById('addCrime'),
        stBody = document.getElementById('stackBody'),
        calc = document.getElementById('calculate'),
        res = document.getElementById('results'),
        modal = document.getElementById('saModal'),
        saOk = document.getElementById('saOk');

  // — Helpers —
  function applyCountry(key, range){
    const cm = countryMods[key];
    if(cm){
      return {
        min: Math.round(range.min*cm.minMul),
        max: Math.round(range.max*cm.maxMul),
        cap: range.cap
      };
    }
    return range;
  }

  // — Populate Subtypes —
  cat.onchange = () => {
    sub.innerHTML = '';
    oth.style.display = 'none';
    const c = cat.value;
    if(!c) return;
    if(c==='sa'){
      modal.style.display = 'flex';
      return;
    }
    if(c==='other'){
      oth.style.display = 'block';
      return;
    }
    sub.disabled = false;
    sub.innerHTML = '<option value="">— Select —</option>';
    categories[c].forEach(k=>{
      const opt = new Option(subtypeLabels[k], k);
      sub.add(opt);
    });
  };
  saOk.onclick = ()=>{
    modal.style.display = 'none';
    cat.onchange();
  };

  // — When subtype or country changes, update overrides —
  function fillOverrides(){
    const key = sub.value;
    if(!key) return;
    let range = defaultRanges[key] || {min:0,max:0,cap:false};
    const ctry = country.value;
    range = applyCountry(ctry, range);
    minY.value = range.min;
    maxY.value = range.max;
    cap.checked = range.cap;
  }
  sub.onchange = fillOverrides;
  country.onchange = fillOverrides;

  // — Add Crime to Stack —
  addB.onclick = ()=>{
    const c = cat.value;
    if(!c) return alert('Select category');
    let label, key;
    if(c==='other'){
      key = 'other_'+Date.now();
      label = oth.value.trim()||'[Custom]';
    } else {
      key = sub.value;
      if(!key) return alert('Select subtype');
      label = subtypeLabels[key];
    }
    const entry = {
      id: Date.now(),
      category:c, subtype:key, label,
      qty: +qty.value||1,
      min: +minY.value||0,
      max: +maxY.value||0,
      cap: cap.checked
    };
    stack.push(entry);
    save(); renderStack();
  };

  // — Render Stack Table —
  function renderStack(){
    stBody.innerHTML = '';
    stack.forEach((e,i)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${e.label}</td>
        <td>${e.qty}</td>
        <td>${e.min}–${e.max}</td>
        <td>${e.cap? 'Yes':'No'}</td>
        <td><small>${definitions[e.label]||''}</small></td>
        <td><button data-idx="${i}">🗑️</button></td>
      `;
      stBody.appendChild(tr);
    });
    // remove handler
    stBody.querySelectorAll('button').forEach(btn=>{
      btn.onclick = ()=>{
        stack.splice(+btn.dataset.idx,1);
        save(); renderStack();
      };
    });
  }

  // — Calculate —
  calc.onclick = ()=>{
    if(stack.length===0) return alert('Add at least one crime');
    const mode = document.querySelector('input[name="mode"]:checked').value;
    let totalMin=0, totalMax=0;
    stack.forEach(e=>{
      if(mode==='concurrent'){
        totalMin = Math.max(totalMin, e.min*e.qty);
        totalMax = Math.max(totalMax, e.max*e.qty);
      } else {
        totalMin += e.min*e.qty;
        totalMax += e.max*e.qty;
      }
    });
    res.innerHTML = `<p><strong>Sentence (${mode}):</strong>
      ${totalMin}–${totalMax} years
      ${stack.some(e=>e.cap)? ' (capital possible)' : ''}.
    </p>`;
  };

  // — Init —
  load();
  if(cat.value) cat.onchange();
  if(sub.value) fillOverrides();

</script>

</body>
</html>
