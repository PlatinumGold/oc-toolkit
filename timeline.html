<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OC Timeline Manager</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <!-- vis-timeline CSS -->
  <link
    href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css"
    rel="stylesheet" />
    <script>
    // â”€â”€ Persistence â”€â”€
    const STORAGE_KEY = 'oc_tl_events';
    let events = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    function saveAll() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
    }

    // â”€â”€ Setup vis DataSet & Timeline â”€â”€
    const items = new vis.DataSet(events);
    const timeline = new vis.Timeline(
      document.getElementById('timeline'),
      items,
      {
        editable:{ add:false, updateTime:true, remove:false },
        interaction:{ dragView:true, zoomKey:'ctrlKey' },
        orientation:'bottom',
        stack:true,
        margin:{ item:10, axis:5 },
        moment: date => vis.moment(date).utc()
      }
    );
    timeline.fit();

    // â”€â”€ Sidebar Form Elements â”€â”€
    const sb        = document.getElementById('sidebar');
    const fTitle    = document.getElementById('formTitle');
    const inId      = document.getElementById('evId');
    const inContent = document.getElementById('evContent');
    const inDesc    = document.getElementById('evDesc');
    const inStart   = document.getElementById('evStart');
    const inEnd     = document.getElementById('evEnd');
    const inColor   = document.getElementById('evColor');
    const inPos     = document.getElementById('evPos');
    const btnSave   = document.getElementById('btnSave');
    const btnDel    = document.getElementById('btnDelete');
    const btnCan    = document.getElementById('btnCancel');
    const btnNew    = document.getElementById('btnNew');
    const btnCenter = document.getElementById('btnCenter');

    // â”€â”€ Helpers â”€â”€
    function isoDate(d){ return vis.moment(d).utc().format('YYYY-MM-DD'); }
    function showForm(data = {}) {
      sb.style.display = 'block';
      if (data.id != null) {
        fTitle.textContent   = 'Edit Event';
        inId.value           = data.id;
        inContent.value      = data.content || '';
        inDesc.value         = data.description || '';
        inStart.value        = isoDate(data.start);
        inEnd.value          = data.end ? isoDate(data.end) : '';
        inColor.value        = data.color || '#4a90e2';
        inPos.value          = data.className || 'top';
        btnDel.style.display = 'inline-block';
      } else {
        fTitle.textContent   = 'New Event';
        inId.value           = '';
        inContent.value      = '';
        inDesc.value         = '';
        inStart.value        = '';
        inEnd.value          = '';
        inColor.value        = '#4a90e2';
        inPos.value          = 'top';
        btnDel.style.display = 'none';
      }
    }
    function hideForm() {
      sb.style.display = 'none';
      timeline.unselect();
    }

    // â”€â”€ Button hooks â”€â”€
    btnNew.onclick    = () => showForm();
    btnCenter.onclick = () => timeline.fit();

    timeline.on('doubleClick', props => {
      if (props.what==='background') {
        const date = timeline.getEventProperties(props.event).time;
        showForm({ start: date });
      }
    });
    timeline.on('select', props => {
      if (props.items.length === 1) {
        const e = items.get(props.items[0]);
        showForm(e);
      }
    });

    // â”€â”€ Save â”€â”€
    btnSave.onclick = () => {
      const rawId  = inId.value;
      const id     = rawId ? +rawId : Date.now();
      const content= inContent.value.trim();
      if (!content) return alert('Title required');

      const start  = inStart.value ? new Date(inStart.value) : new Date();
      const end    = inEnd.value   ? new Date(inEnd.value)   : undefined;
      const color  = inColor.value;
      const cls    = inPos.value;  // 'top' or 'bottom'
      // apply color via style string:
      const style  = `background-color:${color}; border-color:${color}`;

      const rec = { id, content, start, ...(end && { end }), className: cls, description: inDesc.value, color, style };

      if (rawId) {
        items.update(rec);
        events = events.map(e => e.id === id ? rec : e);
      } else {
        items.add(rec);
        events.push(rec);
      }
      saveAll();
      hideForm();
    };

    // â”€â”€ Delete â”€â”€
    btnDel.onclick = () => {
      const id = +inId.value;
      items.remove(id);
      events = events.filter(e => e.id !== id);
      saveAll();
      hideForm();
    };

    // â”€â”€ Cancel â”€â”€
    btnCan.onclick = hideForm;
  </script>
</head>
<body>

  <div id="header">
    ðŸ“… OC Timeline Manager
    <button id="btnCenter">Center</button>
    <button id="btnNew">New Event</button>
  </div>

  <div id="main">
    <div id="timeline"></div>
    <div id="sidebar">
      <h2 id="formTitle">New Event</h2>
      <input type="hidden" id="evId" />

      <label>Title</label>
      <input id="evContent" placeholder="Event titleâ€¦" />

      <label>Description</label>
      <textarea id="evDesc" placeholder="Optional descriptionâ€¦"></textarea>

      <label>Start Date</label>
      <input id="evStart" type="date" />

      <label>End Date (optional)</label>
      <input id="evEnd" type="date" />

      <label>Color</label>
      <input id="evColor" type="color" value="#4a90e2" />

      <label>Position</label>
      <select id="evPos">
        <option value="top">Above line</option>
        <option value="bottom">Below line</option>
      </select>

      <div class="actions">
        <button class="save" id="btnSave">Save</button>
        <button class="delete" id="btnDelete">Delete</button>
        <button class="cancel" id="btnCancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- vis-timeline -->
  <script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <script>
    // â”€â”€ Persistence â”€â”€
    const STORAGE_KEY = 'oc_tl_events';
    let events = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    function saveAll() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
    }

    // â”€â”€ Setup vis DataSet & Timeline â”€â”€
    const items = new vis.DataSet(events);
    const timeline = new vis.Timeline(
      document.getElementById('timeline'),
      items,
      {
        editable:{ add:false, updateTime:true, remove:false },
        interaction:{ dragView:true, zoomKey:'ctrlKey' },
        orientation:'bottom',
        stack:true,
        margin:{ item:10, axis:5 },
        moment: date => vis.moment(date).utc()
      }
    );

    // auto-center on load
    timeline.fit();

    // â”€â”€ Sidebar Form Elements â”€â”€
    const sb       = document.getElementById('sidebar');
    const fTitle   = document.getElementById('formTitle');
    const inId     = document.getElementById('evId');
    const inContent= document.getElementById('evContent');
    const inDesc   = document.getElementById('evDesc');
    const inStart  = document.getElementById('evStart');
    const inEnd    = document.getElementById('evEnd');
    const inColor  = document.getElementById('evColor');
    const inPos    = document.getElementById('evPos');
    const btnSave  = document.getElementById('btnSave');
    const btnDel   = document.getElementById('btnDelete');
    const btnCan   = document.getElementById('btnCancel');
    const btnNew   = document.getElementById('btnNew');
    const btnCenter= document.getElementById('btnCenter');

    // â”€â”€ Helpers â”€â”€
    function isoDate(d){ return vis.moment(d).utc().format('YYYY-MM-DD'); }
    function showForm(eventData) {
      sb.style.display = 'block';
      if (eventData && eventData.id) {
        fTitle.textContent   = 'Edit Event';
        inId.value           = eventData.id;
        inContent.value      = eventData.content;
        inDesc.value         = eventData.description || '';
        inStart.value        = isoDate(eventData.start);
        inEnd.value          = eventData.end   ? isoDate(eventData.end)   : '';
        inColor.value        = eventData.color || '#4a90e2';
        inPos.value          = eventData.className || 'top';
        btnDel.style.display = 'inline-block';
      } else {
        fTitle.textContent = 'New Event';
        [inId, inContent, inDesc, inStart, inEnd].forEach(i=>i.value='');
        inColor.value = '#4a90e2';
        inPos.value   = 'top';
        btnDel.style.display = 'none';
      }
    }
    function hideForm(){ sb.style.display = 'none'; timeline.unselect(); }

    // â”€â”€ Button hooks â”€â”€
    btnNew.onclick    = ()=> showForm({});
    btnCenter.onclick = ()=> timeline.fit();

    // â”€â”€ Double-click background to add â”€â”€
    timeline.on('doubleClick', props => {
      if (props.what==='background') {
        const date = timeline.getEventProperties(props.event).time;
        showForm({ start: date });
      }
    });

    // â”€â”€ Select item to edit â”€â”€
    timeline.on('select', props => {
      if (props.items.length===1) {
        const e = items.get(props.items[0]);
        showForm(e);
      }
    });

    // â”€â”€ Save â”€â”€
    btnSave.onclick = ()=>{
      const id      = inId.value || Date.now();
      const content = inContent.value.trim();
      if (!content) return alert('Title required');
      const start   = inStart.value ? new Date(inStart.value) : new Date();
      const end     = inEnd.value   ? new Date(inEnd.value)   : undefined;
      const color   = inColor.value;
      const cls     = inPos.value;  // 'top' or 'bottom'
      const rec     = { id, content, start, ...(end&&{end}), color, className: cls, description: inDesc.value };

      if (inId.value) {
        items.update(rec);
        events = events.map(e=>e.id==id?rec:e);
      } else {
        items.add(rec);
        events.push(rec);
      }
      saveAll();
      hideForm();
    };

    // â”€â”€ Delete â”€â”€
    btnDel.onclick = ()=>{
      const id = inId.value;
      items.remove(id);
      events = events.filter(e=>e.id!=id);
      saveAll();
      hideForm();
    };

    // â”€â”€ Cancel â”€â”€
    btnCan.onclick = hideForm;
  </script>
</body>
</html>
