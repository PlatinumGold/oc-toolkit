<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OC Timeline Manager</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <!-- vis-timeline CSS -->
  <link
    href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css"
    rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    body, html { margin:0; padding:0; width:100%; height:100%; font-family:Arial,sans-serif; }
    /* header */
    #header {
      height:48px; background:#4a90e2; color:#fff;
      display:flex; align-items:center; padding:0 16px;
      font-size:1.1em;
    }
    #header button {
      margin-left:auto; background:#fff; color:#4a90e2;
      border:none; padding:6px 12px; border-radius:4px;
      cursor:pointer;
    }
    /* main layout */
    #main { display:flex; height:calc(100% - 48px); }
    #timeline {
      flex:1; position:relative;
    }
    /* center line */
    #timeline::before {
      content:''; position:absolute; top:50%; left:0;
      width:100%; height:2px; background:#4a90e2; z-index:0;
    }
    /* hide default group labels */
    .vis-timeline .vis-labelset { display:none; }
    /* force vis panels to fill */
    #timeline .vis-timeline,
    #timeline .vis-panel,
    #timeline .vis-time-axis { height:100% !important; }

    /* sidebar */
    #sidebar {
      width:320px; background:#fefefe; border-left:1px solid #ccc;
      padding:16px; overflow-y:auto; display:none;
    }
    #sidebar h2 { margin-top:0; color:#4a90e2; }
    #sidebar label { display:block; margin:12px 0 4px; font-weight:bold; }
    #sidebar input, #sidebar textarea, #sidebar select, #sidebar button {
      width:100%; padding:6px; margin-bottom:8px;
    }
    #sidebar textarea { resize:vertical; height:60px; }
    .actions { display:flex; gap:8px; margin-top:12px; }
    .actions button {
      flex:1; padding:8px; border:none; border-radius:4px; cursor:pointer;
    }
    .save   { background:#4a90e2; color:#fff; }
    .delete { background:#e74c3c; color:#fff; }
    .cancel { background:#ccc; }
  </style>
</head>
<body>

  <div id="header">
    ðŸ“… OC Timeline Manager
    <button id="btnCenter">Center</button>
    <button id="btnNew">New Event</button>
  </div>

  <div id="main">
    <div id="timeline"></div>
    <div id="sidebar">
      <h2 id="formTitle">New Event</h2>
      <input type="hidden" id="evId" />

      <label>Title</label>
      <input id="evContent" placeholder="Event titleâ€¦" />

      <label>Description</label>
      <textarea id="evDesc" placeholder="Optional descriptionâ€¦"></textarea>

      <label>Start Date</label>
      <input id="evStart" type="date" />

      <label>End Date (optional)</label>
      <input id="evEnd" type="date" />

      <label>Color</label>
      <input id="evColor" type="color" value="#4a90e2" />

      <label>Position</label>
      <select id="evPos">
        <option value="1">Above line</option>
        <option value="2">Below line</option>
      </select>

      <div class="actions">
        <button class="save"   id="btnSave">Save</button>
        <button class="delete" id="btnDelete">Delete</button>
        <button class="cancel" id="btnCancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- vis-timeline -->
  <script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <script>
    // persistence key
    const STORAGE_KEY = 'oc_tl_events';

    // load & rehydrate dates
    let events = [];
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        JSON.parse(raw).forEach(e => {
          events.push({
            ...e,
            start: new Date(e.start),
            end:   e.end ? new Date(e.end) : undefined
          });
        });
      }
    } catch(err) {
      console.warn('Could not load events', err);
    }

    function saveAll(){
      localStorage.setItem(STORAGE_KEY,
        JSON.stringify(events)
      );
    }

    // two groups: 1=Above, 2=Below
    const groups = new vis.DataSet([
      { id:1, content:'Above' },
      { id:2, content:'Below' }
    ]);

    // dataset & timeline
    const items = new vis.DataSet(events);
    const timeline = new vis.Timeline(
      document.getElementById('timeline'),
      { items, groups },
      {
        height:'100%', width:'100%',
        editable:{ updateTime:true, updateGroup:true },
        interaction:{ dragView:true, zoomKey:'ctrlKey' },
        orientation:'bottom',
        stack:true,
        margin:{ item:10, axis:5 },
        moment: d => vis.moment(d).utc()
      }
    );

    // auto-center
    timeline.fit();

    // sidebar refs
    const sb       = document.getElementById('sidebar');
    const fTitle   = document.getElementById('formTitle');
    const inId     = document.getElementById('evId');
    const inC      = document.getElementById('evContent');
    const inD      = document.getElementById('evDesc');
    const inS      = document.getElementById('evStart');
    const inE      = document.getElementById('evEnd');
    const inCol    = document.getElementById('evColor');
    const inP      = document.getElementById('evPos');
    const btnSave  = document.getElementById('btnSave');
    const btnDel   = document.getElementById('btnDelete');
    const btnCan   = document.getElementById('btnCancel');
    const btnNew   = document.getElementById('btnNew');
    const btnCenter= document.getElementById('btnCenter');

    function isoDate(d){
      return vis.moment(d).utc().format('YYYY-MM-DD');
    }

    function showForm(e){
      sb.style.display = 'block';
      if (e && e.id) {
        fTitle.textContent = 'Edit Event';
        inId.value  = e.id;
        inC.value   = e.content;
        inD.value   = e.description||'';
        inS.value   = isoDate(e.start);
        inE.value   = e.end ? isoDate(e.end) : '';
        inCol.value = e.color||'#4a90e2';
        inP.value   = e.group;
        btnDel.style.display = 'inline-block';
      } else {
        fTitle.textContent = 'New Event';
        [inId,inC,inD,inS,inE].forEach(i=>i.value='');
        inCol.value = '#4a90e2';
        inP.value   = '1';
        btnDel.style.display = 'none';
      }
    }

    function hideForm(){
      sb.style.display = 'none';
      timeline.unselect();
    }

    // New / Center buttons
    btnNew.onclick    = ()=> showForm({});
    btnCenter.onclick = ()=> timeline.fit();

    // double-click background
    timeline.on('doubleClick', props=>{
      if (props.what === 'background') {
        showForm({
          start: props.time,
          group: 1,
          color: '#4a90e2'
        });
      }
    });

    // click an item
    timeline.on('select', props=>{
      if (props.items.length===1) {
        const e = items.get(props.items[0]);
        showForm(e);
      }
    });

    // save
    btnSave.onclick = ()=>{
      const id      = inId.value || Date.now();
      const content = inC.value.trim();
      if (!content) return alert('Title required');
      const start = inS.value ? new Date(inS.value) : new Date();
      const end   = inE.value ? new Date(inE.value) : undefined;
      const color = inCol.value;
      const group = Number(inP.value);

      const rec = { id, content, start, group, color, description: inD.value };
      if (end) rec.end = end;

      if (inId.value) {
        items.update(rec);
        events = events.map(ev => ev.id==id ? rec : ev);
      } else {
        items.add(rec);
        events.push(rec);
      }
      saveAll();
      hideForm();
    };

    // delete
    btnDel.onclick = ()=>{
      const id = inId.value;
      items.remove(id);
      events = events.filter(ev=>ev.id!=id);
      saveAll();
      hideForm();
    };

    // cancel
    btnCan.onclick = hideForm;
  </script>
</body>
</html>
